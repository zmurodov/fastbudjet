/*
 Copyright ?2020-2021 AppFer S.R.L. - All rights reserved. */
'use strict'; function Ea(a, b, c) { try { return (new Intl.NumberFormat(b, { style: "currency", currency: c, minimumFractionDigits: 0, maximumFractionDigits: 0 })).format(a) } catch (d) { return fa(parseFloat(a), b, 0, 0) } } function Fa(a) { var b = P; return (new Date(a)).toLocaleDateString(b ? b : "en", { month: "2-digit", day: "2-digit" }) } function Ga(a) { var b = P; return (new Date(a)).toLocaleDateString(b ? b : "en", { year: "2-digit", month: "2-digit" }) }
function Ha(a) { var b = P; return (new Date(a)).toLocaleDateString(b ? b : "en", { year: "numeric", month: "long" }) } function Ia(a) { var b = P; return (new Date(a)).toLocaleDateString(b ? b : "en", { year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit" }) } var Ja = 0; function Ka(a = 300) { if (Ja > Date.now() - a) return !1; Ja = Date.now(); return !0 } function La(a, b, c) { sa(a, b, p.ok, c); $("#modal_message_content").html(b) } function Ma(a, b) { a.removeClass("is-invalid"); b ? a.val(b) : a.val("") }
var R = M("defCurrency", ""), Na = 0, S = "true" === Cookies.get("trial"), T, Oa, Pa, Qa = !1, U, Ra = !1, V = new Map, Sa, W = Object.freeze({ u: 0, l: 2, m: 4, s: 5, A: 10 }); F("js_data_holder"); var P = w.substr(0, 2) + "-" + p.country_code_2l;
firebase.auth().onAuthStateChanged(a => {
    if (a) if (window.indexedDB || (window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB), window.indexedDB && "undefined" !== typeof Storage) {
        var b = M("user:previous_user_and_type", null); a = a.email + "::" + (p.is_trial ? "trial" : "prod"); null == b && b !== a && (E("user:previous_user_and_type", a), E("seCid", null), indexedDB.deleteDatabase("fastBudgetDB"), E("lastSyncTs", null), E("lastSettingsSyncTs", null), E("transactionsSyncFromTs", null)); p.is_trial ?
            Ta().then(() => { "function" === typeof Ua ? Ua() : setTimeout(() => { "function" === typeof Ua ? Ua() : setTimeout(() => { "function" === typeof Ua ? Ua() : setTimeout(() => { Ua() }, 800) }, 300) }, 200) }) : Ta().then(() => { "function" === typeof Va ? Va() : setTimeout(() => { "function" === typeof Va ? Va() : setTimeout(() => { "function" === typeof Va ? Va() : setTimeout(() => { Va() }, 800) }, 300) }, 200) }); Wa()
    } else console.log("Your Browser does not support the features required from our web app.<br>Please, update it to the latest version."), alert("Your Browser does not support the features required from our web app.<br>Please, update it to the latest version.");
    else ia()
});
function Ta() {
    T = new Dexie("fastBudgetDB"); T.version(7).stores({ accounts: "id, name, position, bsId, bsConnectionId", creditCards: "id, name, position", categories: "id, name, ei, parentId, position", transactions: "id, date, [ei+date], [account+date], [category+date]", scheduledTransaction: "id, ei, category, nextDate", transactionTemplates: "id, ei, position", budgets: "id, period", debts: "id, type, position", bsConnections: "id" }); T.on("blocked", () => {
        let a; switch (window.navigator.language.slice(0, 2)) {
            default: a = "Error: close all other tabs with this site open and refresh the page";
                break; case "it": a = "Errore: chiudi tutte le altre schede con questo sito aperto e aggiorna la pagina"; break; case "pt": a = "Erro: feche todas as outras guias com este site aberto e atualize a p\u00e1gina"; break; case "es": a = "Error: cierre todas las dem\u00e1s pesta\u00f1as con este sitio abierto y actualice la p\u00e1gina"; break; case "fr": a = "Erreur: Fermez tous les autres onglets lorsque ce site est ouvert et actualisez la page."; break; case "de": a = "Fehler: Schlie\u00dfen Sie alle anderen Registerkarten, w\u00e4hrend diese Site ge\u00f6ffnet ist, und aktualisieren Sie die Seite";
                break; case "nl": a = "Fout: sluit alle andere tabbladen met deze site open en vernieuw de pagina"; break; case "pl": a = "B\u0142\u0105d: zamknij wszystkie inne karty z otwart\u0105 witryn\u0105 i od\u015bwie\u017c stron\u0119"; break; case "cs": a = "Chyba: zav\u0159ete v\u0161echny ostatn\u00ed karty a obnovte str\u00e1nku"; break; case "el": a = "\u03a3\u03c6\u03ac\u03bb\u03bc\u03b1: \u03ba\u03bb\u03b5\u03af\u03c3\u03c4\u03b5 \u03cc\u03bb\u03b5\u03c2 \u03c4\u03b9\u03c2 \u03ac\u03bb\u03bb\u03b5\u03c2 \u03ba\u03b1\u03c1\u03c4\u03ad\u03bb\u03b5\u03c2 \u03bc\u03b5 \u03c4\u03bf \u03ac\u03bd\u03bf\u03b9\u03b3\u03bc\u03b1 \u03b1\u03c5\u03c4\u03bf\u03cd \u03c4\u03bf\u03c5 \u03b9\u03c3\u03c4\u03cc\u03c4\u03bf\u03c0\u03bf\u03c5 \u03ba\u03b1\u03b9 \u03b1\u03bd\u03b1\u03bd\u03b5\u03ce\u03c3\u03c4\u03b5 \u03c4\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1";
                break; case "ru": a = "\u041e\u0448\u0438\u0431\u043a\u0430: \u0437\u0430\u043a\u0440\u043e\u0439\u0442\u0435 \u0432\u0441\u0435 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0435 \u0432\u043a\u043b\u0430\u0434\u043a\u0438 \u0438 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443"; break; case "th": a = "\u0e02\u0e49\u0e2d\u0e1c\u0e34\u0e14\u0e1e\u0e25\u0e32\u0e14: \u0e1b\u0e34\u0e14\u0e41\u0e17\u0e47\u0e1a\u0e2d\u0e37\u0e48\u0e19\u0e17\u0e31\u0e49\u0e07\u0e2b\u0e21\u0e14\u0e42\u0e14\u0e22\u0e17\u0e35\u0e48\u0e44\u0e0b\u0e15\u0e4c\u0e19\u0e35\u0e49\u0e40\u0e1b\u0e34\u0e14\u0e02\u0e36\u0e49\u0e19\u0e41\u0e25\u0e30\u0e23\u0e35\u0e40\u0e1f\u0e23\u0e0a\u0e2b\u0e19\u0e49\u0e32";
                break; case "id": case "in": a = "Kesalahan: tutup semua tab lain dan segarkan laman"
        }B(null, a)
    }); T.on("ready", () => T.transactions.count(a => { 0 === a ? (E("lastSyncTs", null), E("lastSettingsSyncTs", null), E("transactionsSyncFromTs", null)) : Xa() })); T.open().catch(a => { console.error("Failed to open db: " + (a.stack || a)); D(1, "internal_page_frame.js", "Opening idb", a.stack || a) }); 1 > parseInt(M("storagePersisted", 0)) && Ya(); return Promise.resolve()
}
function Za(a) { var b = R; a = void 0 === a ? !1 : a; return new Promise(c => { if (!a && parseInt(M("lastExRateUpdate", 0)) > Date.now() - 576E5 || null != Sa && 10 < Sa.length || null == b) return c(); $.ajax({ url: "https://apilayer.net/api/live?access_key=2808824894092e6d7c5834305de0b5d5&source=" + b, dataType: "json", success: function (d) { Sa = d.quotes; E("lastExRateUpdate", Date.now()); return c() } }) }) }
function Xa() {
    R && Za(!1).then(() => { if (null == Sa) return Promise.resolve(null); let a = T.accounts.toArray(), b = T.creditCards.toArray(); return Promise.all([a, b]) }).then(a => {
        if (!a) return Promise.resolve(null); a[0].forEach(b => {
            if (0 !== b.autoExRate && null != b.isoCurrency) {
                var c = b.isoCurrency.split("-")[0].trim(); if (c !== R) {
                    var d = Sa[R + c]; null != d && (c = b.exchangeRate, d > c + .02 * c || d < c - .02 * c) && (b.exchangeRate = d, T.accounts.update(b.id, b), a[1].forEach(e => {
                        e.associatedAccount === b.name && (e.exchangeRate = d, T.creditCards.update(e.id,
                            e))
                    }))
                }
            }
        })
    })
} function X(a) { a = void 0 === a ? !1 : a; return Oa ? Oa.then(() => { let b = $a(a), c = ab(a); return Promise.all([b, c]) }) : (new Promise(b => setTimeout(b, 150))).then(() => X(a)) }
function $a(a) {
    a = void 0 === a ? !1 : a; return new Promise((b, c) => {
        if (null == T) return c(); !a && Qa && null != Pa && 0 < Pa.size ? c = Promise.resolve() : (Pa = new Map, c = T.categories.each(e => { Pa.set(e.name, e.iconName) }).then(function () { Qa = !0 })); let d; if (!a && Ra && null != U && 0 < U.size) d = Promise.resolve(); else {
            U = new Map; let e = new Map; d = T.accounts.each(f => { U.set(f.name, [f.isoCurrency.split("-")[0].trim(), 0 < parseInt(f.visibility, 10) ? "1" : "0", "0", f.exchangeRate, !!f.bsId]) }).then(() => T.creditCards.each(f => {
                let h = U.get(f.associatedAccount);
                e.set(f.name, [h ? h[0] : R, "1", "1", f.exchangeRate, !1])
            })).then(() => { U = new Map([...U, ...e]); Ra = !0 })
        } Promise.all([c, d]).then(function () { return b() })
    })
} function ab(a) { return (void 0 === a || !a) && null != V && 0 < V.size ? Promise.resolve() : new Promise((b, c) => { if (null == T) return c(); null == V && (V = new Map); T.transaction("r", T.creditCards, T.transactions, () => T.creditCards.each(d => { bb(d) })).then(function () { return b() }) }) }
function cb(a, b, c) {
    if (S) return !0; var d = parseInt(M("transactionsSyncFromTs", 9999999999999)); 0 >= d && (d = new Date, d.setMonth(d.getMonth() - 3), d = d.getTime(), E("transactionsSyncFromTs", d)); return a < d ? (b && (b.empty(), b.append('<div class="progress">    <div class="progress-bar progress-bar-striped progress-bar-animated" id="spinner_waiting" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>')), b = firebase.auth().currentUser, db(b, a, d).then(() => { c() }),
        !1) : !0
}
function eb(a, b) {
    b = void 0 === b ? null : b; if (S) return Promise.resolve(); var c = parseInt(M("transactionsSyncFromTs", 9999999999999)); 0 >= c && (c = new Date, c.setMonth(c.getMonth() - 3), c = c.getTime(), E("transactionsSyncFromTs", c)); return a < c ? (b && (b.empty(), b.append('<div class="progress">    <div class="progress-bar progress-bar-striped progress-bar-animated" id="spinner_waiting" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>')), b = firebase.auth().currentUser, db(b,
        a, c)) : Promise.resolve()
} function fb(a, b) { 0 < b ? a.css({ color: "#4CAF50" }) : 0 > b ? a.css({ color: "#F44336" }) : a.css({ color: "#000000" }) }
function gb() {
    let a = navigator.language.toLowerCase(); return a.includes("it") || a.includes("de") || a.includes("nl") || a.includes("el") ? "EUR - \u20ac" : a.includes("pt") ? a.includes("pt-pt") ? "EUR - \u20ac" : "BRL - B$" : a.includes("en") ? a.includes("gb") ? "GBP - \u00a3" : a.includes("ca") ? "CAD - C$" : a.includes("au") ? "AUD - A$" : a.includes("in") ? "INR - \u20b9" : a.includes("ie") ? "EUR - \u20ac" : "USD - $" : a.includes("fr") ? a.includes("ca") ? "CAD - C$" : "EUR - \u20ac" : a.includes("ru") ? "RUB - \u20bd" : a.includes("pl") ? "PLN - z\u0142" :
        a.includes("cs") ? "CZK - K\u010d" : a.includes("da") ? "DKK - kr" : a.includes("id") ? "IDR - Rp" : a.includes("ms") ? "MYR - RM" : a.includes("th") ? "THB - \u0e3f" : a.includes("vi") ? "VND - \u20ab" : a.includes("tr") ? "TRY - \u20ba" : a.includes("iw") || a.includes("he") ? "ILS - \u20aa" : a.includes("ar") ? "SAR - \ufdfc" : a.includes("jp") ? "JPY - \u00a5" : "USD - $"
}
function hb(a, b, c, d, e, f) {
    d = void 0 === d ? null : d; e = void 0 === e ? !1 : e; f = void 0 === f ? !1 : f; if (Qa && null != Pa) {
        d || (d = M("defTrStatus", "0")); a.id || (d = "2", f = !0, a.id = Math.round(1E5 * Math.random()).toString()); c.append(b); var h = $("div[id=template_transaction_container]").last(), k = ib(a.category); h.find("#template_tr_icon_category").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + k.iconName); var l = U.get(a.account); l = x((0 === a.ei ? -1 : 1) * parseFloat(a.value), w, l ? l[0] :
            R); h.find("#template_tr_value").text(l); l = !!a.bsId && a.bsIsPending; var m = 0 === a.ei ? e || l ? "#EF9A9A" : "#F44336" : e || l ? "#C8E6C9" : "#4CAF50"; h.find("#template_tr_color").css({ "background-color": m }); h.find("#template_tr_category").text(k.categoryCorrectedName); h.find("#template_tr_account").text(a.account); h.find("#template_tr_date").text(y(parseInt(a.date), P)); m = h.find("#template_tr_options"); jb(0, a, m, k.isSpecialTransaction, e, f); h.find("#template_tr_from_to").text(a.fromTo ? a.fromTo : "-"); h.find("#template_tr_notes").text(a.notes ?
                a.notes : "-"); h.find("#template_tr_added_from").text(a.addedFrom ? a.addedFrom : ""); l && h.find("#template_tr_is_pending").removeClass("hidden-element"); if ("2" !== d) { let q = h.find("#template_tr_checked_btn"); if (1 !== a.checked) q.addClass("hidden-element"); else { let r = h.find("#template_tr_icon_unchecked"); r.removeClass("hidden-element"); q.removeClass("btn-red btn-green hidden-element"); q.addClass(0 === a.ei ? "btn-red" : "btn-green"); q.on("click touch", function () { q.addClass("hidden-element"); kb(a).then(() => { r.addClass("hidden-element") }) }) } } var n =
                    a.id.replace("*", ""); h.children()[1].id = n; h.find(":first-child").on("click touch", function () {
                        if ("true" === M("useTransactionHour", "false")) { let q = h.find("#template_tr_date"); 15 > q.text().length ? q.text(Ia(parseInt(a.date))) : q.text(y(parseInt(a.date), P)) } h.find("#" + n).collapse("toggle"); if (a.photoName) {
                            let q = h.find("#button_tr_download_photo"), r = h.find("#template_tr_photo_img"); if (!r.attr("src") || 5 > r.attr("src").length) q.removeClass("hidden-element"), q.off("click touch").on("click touch", u => {
                                u.preventDefault();
                                u.stopPropagation(); u.cancelBubble = !0; let v = h.find("#template_tr_photo_waiting"); v.removeClass("hidden-element"); u = h.find("#template_tr_photo_not_found"); lb(a.photoName, r, u).finally(() => { v.addClass("hidden-element") }); q.addClass("hidden-element")
                            })
                        }
                    })
    } else $a().then(() => { hb(a, b, c, d, e, f) })
}
function jb(a, b, c, d, e, f) {
    e = void 0 === e ? !1 : e; f = void 0 === f ? !1 : f; let h = c.find(0 === a ? "#template_tr_options_duplicate" : "#tabular_menu_duplicate"), k = c.find(0 === a ? "#template_tr_options_edit" : "#tabular_menu_edit"), l = c.find(0 === a ? "#template_tr_options_delete" : "#tabular_menu_delete"), m = !!b.bsId && b.bsIsPending; if (f || m) m && b.date < Date.now() - 432E6 ? (h.addClass("hidden-element"), k.addClass("hidden-element"), l.on("click touch", function () { mb(b) })) : (c.removeClass("dropdown"), a = c.find(".transaction_options"), a.removeAttr("data-toggle"),
        a.removeClass("transaction_options"), a.addClass("transaction_options_disabled"), a.find("i").addClass("hidden-element")); else {
        768 > $(window).width() && c.find(".dropdown-menu").addClass("dropdown-menu-right"); f = U.get(b.account); if (!b.bsId || f && !f[4]) {
            let n = "Transfer between accounts" === b.category; if (!b.id || e || d && !n) h.addClass("hidden-element"); else h.removeClass("hidden-element").on("click touch", function (q) { q.stopPropagation(); n ? nb(2, b.account, b) : (q = jQuery.extend({}, b), q.id = null, ob(b.ei, q, !1)) }); if (!b.id ||
                e || d && ("CCARD_Monthly_Bill" === b.category || "CCARD_Manual_Bill" === b.category || S)) k.addClass("hidden-element"); else k.on("click touch", function () { ob(b.ei, b, e) }); if (b.id) l.on("click touch", function () { e ? pb(b) : mb(b) }); else l.addClass("hidden-element")
        } else "Transfer between accounts" !== b.category ? (h.text(p.transfer_between_accounts + "?"), h.on("click touch", function (n) { n.stopPropagation(); qb(b) })) : h.addClass("hidden-element"), k.on("click touch", function () { ob(b.ei, b, e) }), b.bsPosDup ? (l.text(p.duplicated_transaction_error),
            l.on("click touch", function () {
                sa(p.duplicated_transaction_error, p.duplicated_transaction_error_txt, null, () => g(function* () {
                    $("#progress_waiting_container_internal").removeClass("hidden-element"); var n = firebase.auth().currentUser; const q = n.uid; n = yield n.getIdToken(); rb(q, n, b.id, b.bsId).then(() => { setTimeout(function () { $("#progress_waiting_container_internal").addClass("hidden-element"); sb() }, 500) }).catch(r => {
                        $("#progress_waiting_container_internal").addClass("hidden-element"); B(p.error, (r ? r : p.error) +
                            " - BSTD01")
                    })
                }))
            })) : l.addClass("hidden-element"); if (1 === a) if (1 === b.checked) { let n = c.find("#tabular_menu_check"); n.removeClass("hidden-element"); n.off("click touch").on("click touch", function () { kb(b).then(() => { n.addClass("hidden-element"); c.addClass("hidden-element"); try { $("tr[data-ID='" + b.id + "']").find("td").removeClass("text-danger") } catch (q) { } }) }) } else c.find("#tabular_menu_check").addClass("hidden-element")
    }
}
function qb(a) {
    let b = p.mark_tr_as_transfer + '\n\n"' + a.category + '" \u25ba "' + p.transfer_between_accounts + '"'; sa(p.category.replace(":", ""), b, null, () => {
        var c = firebase.auth().currentUser; c = firebase.database().ref("usersDatabase/" + c.uid + "/transactions"); let d = { category: "Transfer between accounts", ts: firebase.database.ServerValue.TIMESTAMP }; c.child(a.id).update(d).then(() => { setTimeout(function () { populateTransactionList() }, 500) }).catch(function (e) {
            $("#progress_waiting_container_external").addClass("hidden-element");
            B(); D(3, "internal_main.js", "Mark bs tr as transfer", e)
        })
    })
} function kb(a) { if (S) return T.transactions.update(a.id, { checked: 0 }); G("lastTransactionAction", Date.now()); let b = firebase.auth().currentUser; return firebase.database().ref("usersDatabase/" + b.uid + "/transactions").child(a.id).update({ ch: 0, ts: firebase.database.ServerValue.TIMESTAMP }).catch(() => { D(3, "internal_main.js", "Checking transaction", "Error on checking transaction"); B() }) }
function mb(a) {
    if (S) tb(a); else {
        var b = U.get(a.account); a.bsId && b && b[4] ? B() : sa(p.delete_transaction, p.account_restored, p.ok, function () {
            $("#progress_waiting_container_external").removeClass("hidden-element"); let c = V.get(a.account); if (null == c) B(); else {
                var d = c - (0 === a.ei ? -1 : 1) * a.value, e = firebase.auth().currentUser, f = firebase.database().ref("usersDatabase/" + e.uid + "/transactions"), h = { state: 1, ts: firebase.database.ServerValue.TIMESTAMP }; G("lastTransactionAction", Date.now()); f.child(a.id).update(h).then(() =>
                    Y(e, a.account, d)).then(() => {
                        if ("Transfer between accounts" === a.category || "CCARD_Monthly_Bill" === a.category || "CCARD_Manual_Bill" === a.category) T.transactions.where(["ei", "date"]).equals([1 === a.ei ? 0 : 1, a.date]).toArray(k => {
                            k.forEach(l => {
                                if (a.fromTo === l.account) return f.child(l.id).update(h).then(() => { let m = V.get(l.account); null != m && Y(e, l.account, m - (0 === l.ei ? -1 : 1) * l.value) }).catch(m => {
                                    D(3, "internal_main.js", "Delete other transfer/payment transaction: " + f.toString().substring(f.root.toString().length),
                                        "Delete other transfer/payment transaction: " + m)
                                })
                            })
                        }); else if ("_debt_" === a.category || "_credit_" === a.category) return T.debts.toArray(k => {
                            for (var l = 0; l < k.length; l++) {
                                let n = k[l]; var m = n.relatedTransactionIds; if (null == m || !m.includes(a.id)) continue; n.relatedTransactionIds = m.split("$").filter(r => r !== a.id).join("$"); k = a.value; n.account !== a.account && (l = U.get(n.account), m = U.get(a.account), l[3] !== m[3] && (k = k / m[3] * l[3])); l = n.repaidAmount || 0; 0 === n.type ? 0 === a.ei && (l -= k) : 1 === a.ei && (l -= k); if (Number.isNaN(l) || 0 >
                                    l) l = 0; let q = firebase.database().ref("usersDatabase/" + e.uid + "/debts/" + n.id); return q.update({ relatedTransactionIds: n.relatedTransactionIds, repaidAmount: l, ts: firebase.database.ServerValue.TIMESTAMP }).then(() => T.debts.update(n.id, n)).catch(r => { D(3, "internal_main.js", "Edit debt after transaction deletion: " + q.toString().substring(q.root.toString().length), r) })
                            }
                        })
                    }).then(() => { setTimeout(function () { sb() }, 500) }).catch(k => {
                        $("#progress_waiting_container_external").addClass("hidden-element"); B(); D(3, "internal_main.js",
                            "Delete transaction: " + f.toString().substring(f.root.toString().length), k)
                    })
            }
        })
    }
}
function tb(a) {
    sa(p.delete_transaction, p.account_restored, p.ok, function () {
        $("#progress_waiting_container_external").removeClass("hidden-element"); T.transactions.delete(a.id).then(() => { let b = V.get(a.account); null != b && V.set(a.account, b - (0 === a.ei ? -a.value : +a.value)) }).then(() => {
            if ("Transfer between accounts" === a.category || "CCARD_Monthly_Bill" === a.category || "CCARD_Manual_Bill" === a.category) T.transactions.where(["ei", "date"]).equals([1 === a.ei ? 0 : 1, a.date]).toArray(b => {
                b.forEach(c => {
                    if (a.fromTo === c.account) return T.transactions.delete(c.id).then(() => { let d = V.get(c.account); null != d && V.set(c.account, d - (0 === c.ei ? -c.value : +c.value)) })
                })
            }); else if ("_debt_" === a.category || "_credit_" === a.category) return T.debts.toArray(b => { for (let c = 0; c < b.length; c++) { let d = b[c], e = d.relatedTransactionIds; if (null != e && e.includes(a.id)) return d.relatedTransactionIds = e.split("$").filter(f => f !== a.id).join("$"), b = d.repaidAmount, 0 === d.type ? 0 === a.ei && (b -= a.value) : b -= 0 === a.ei ? -a.value : +a.value, 0 > b && (b = 0), d.repaidAmount = b, T.debts.update(d.id, d) } })
        }).then(() => { sb() })
    })
}
function sb() { gtag("event", "delete_transaction", { event_category: "engagement" }); $("#progress_waiting_container_external").addClass("hidden-element"); switch (Na) { default: populateTransactionList(); break; case 9: setCalendarPage(!0) } }
function pb(a) {
    sa(p.delete_transaction, p.scheduled_transaction, p.ok, function () {
        $("#progress_waiting_container_external").removeClass("hidden-element"); if (S) { var b = T.scheduledTransaction.delete(a.id); b.catch(c => { $("#progress_waiting_container_external").addClass("hidden-element"); B(); D(3, "page_transactions.js", "Trial - Delete scheduled transaction", c) }) } else {
            b = firebase.auth().currentUser; const c = firebase.database().ref("usersDatabase/" + b.uid + "/scheduledTransactions"); b = { state: 1, ts: firebase.database.ServerValue.TIMESTAMP };
            b = c.child(a.id).update(b).catch(d => { $("#progress_waiting_container_external").addClass("hidden-element"); B(); D(3, "page_transactions.js", "Delete scheduled transaction: " + c.toString().substring(c.root.toString().length), d) })
        } b.then(() => { gtag("event", "delete_scheduled_tr", { event_category: "engagement" }); setTimeout(function () { $("#progress_waiting_container_external").addClass("hidden-element"); switch (Na) { default: populateScheduledTransactionList(a.ei); break; case 9: setCalendarPage(!0) } }, 500) })
    })
}
function ub(a, b, c, d) {
    c.append(b); const e = $("div[id=t_budget_container]").last(); d || e.find(":first-child").first().removeClass("item_selector_light"); e.find("#t_budget_name").text("_all_categories_" !== a.name ? a.name : p.all_categories); e.find("#t_budget_zero_value").text(x(0, w, R)); e.find("#t_budget_max_value").text(x(a.maxValue, w, R)); b = a.iconName ? a.iconName + ".svg" : (b = Pa.get(a.category)) ? b + ".svg" : "_all_categories_" === a.category || a.category === p.all_categories ? "ic_all_data.svg" : "ic_blank_grey.svg"; e.find("#t_budget_icon").on("error",
        function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + b); b = vb(a, 0); e.find("#t_budget_date_from").text(y(b.h, P)); e.find("#t_budget_date_to").text(y(b.g, P)); if (-1 === b.g) c.last().remove(); else {
            if (d) {
                let f = !1; c = e.find("#t_budget_buttons"); c.removeClass("hidden-element"); c.find("#t_budget_options").on("click touch", function () { f = !0 }); c.find("#t_budget_options_edit").on("click touch", function () {
                    t.set("selectedBudgetObj", a); A(p.url_budget_new_modal, "/static/" + (!0 ===
                        p.use_min_files ? "js/" + p.js_version + "/modal_new_budget.min.js" : "javascript/secondary_pages/modal_new_budget.js"), $("#modal_container"), {}, !1)
                }); c.find("#t_budget_options_delete").on("click touch", function () { deleteBudget(a) }); e.on("click touch", function () { if (f) f = !1; else { t.set("selectedBudgetObj", a); var h = $("#navbutton_transactions"); A(h.data("html"), h.data("script"), null, { transaction_type: W.m }) } })
            } else e.find("#t_budget_buttons").addClass("hidden-element"); return wb(a, b.h, b.g).then(f => {
                let h = f / a.maxValue *
                    100; 0 > h && (h = 0); var k = a.maxValue - f; 0 > k ? k = 0 : k > a.maxValue && (k = a.maxValue); e.find("#t_budget_current_value").text(x(f, w, R)); var l = e.find("#t_budget_residual_amount"); l.text(p.residual_amount + " " + x(k, w, R)); d || l.addClass("small_text mt-1"); k = e.find("#t_budget_limit_percentage"); k.text((new Intl.NumberFormat(w, { style: "percent", maximumFractionDigits: 0 })).format(h / 100)); let m, n = e.find("#t_budget_progress"); f >= .95 * a.maxValue ? l = m = "#F44336" : f >= .7 * a.maxValue ? l = m = "#FF9800" : (m = "#4CAF50", l = "#000000"); n.css({ "background-color": m });
                n.css({ width: h + "%" }); k.css({ color: l }); return Promise.resolve(f)
            })
        }
}
function xb(a, b, c, d, e) {
    a = void 0 === a ? !1 : a; b = void 0 === b ? !1 : b; c = void 0 === c ? !1 : c; d = void 0 === d ? !1 : d; e = void 0 === e ? !0 : e; const f = $("#fab_add_tr_general"), h = $("#fab_add_tr_expense"), k = $("#fab_add_tr_income"), l = $("#fab_add_tr_transfer"), m = $("#fab_add_tr_payment"); let n = $(window).width(); if (768 > n && (e || a || a)) {
        c && (f.css({ marginRight: "10px" }), h.css({ marginRight: "10px" }), k.css({ marginRight: "10px" }), l.css({ marginRight: "10px" }), m.css({ marginRight: "10px" })); let q = !1; h.addClass("hidden-element"); k.addClass("hidden-element");
        l.addClass("hidden-element"); m.addClass("hidden-element"); f.on("click touch", function () {
            q ? (f.css({ transform: "rotate(0deg)" }), h.animate({ marginBottom: "0.75rem" }, 200), h.delay(200).queue(function () { $(this).addClass("hidden-element"); $(this).dequeue() }), e && (k.animate({ marginBottom: "0.75rem" }, 200), k.delay(200).queue(function () { $(this).addClass("hidden-element"); $(this).dequeue() })), a && (l.animate({ marginBottom: "0.75rem" }, 200), l.delay(200).queue(function () { $(this).addClass("hidden-element"); $(this).dequeue() })),
                b && (m.animate({ marginBottom: "0.75rem" }, 200), m.delay(200).queue(function () { $(this).addClass("hidden-element"); $(this).dequeue() }))) : (f.css({ transform: "rotate(-180deg)" }), h.animate({ marginBottom: "4.95rem" }, 200), h.removeClass("hidden-element"), e && (k.animate({ marginBottom: "9.15rem" }, 200), k.removeClass("hidden-element")), a && (l.animate({ marginBottom: "13.35rem" }, 200), l.removeClass("hidden-element")), b && (m.animate({ marginBottom: "13.35rem" }, 200), m.removeClass("hidden-element"))); q = !q
        }); $(window).on("scroll",
            function () { $(window).scrollTop() + $(window).height() > $(document).height() - 73 ? (f.addClass("fab_no_overlap_footer_0"), h.addClass("fab_no_overlap_footer_1"), k.addClass("fab_no_overlap_footer_2"), a && l.addClass("fab_no_overlap_footer_3"), b && m.addClass("fab_no_overlap_footer_3")) : (f.removeClass("fab_no_overlap_footer_0"), h.removeClass("fab_no_overlap_footer_1"), k.removeClass("fab_no_overlap_footer_2"), a && l.removeClass("fab_no_overlap_footer_3"), b && m.removeClass("fab_no_overlap_footer_3")) })
    } else c && 1481 >
        n ? (f.css({ marginRight: "10px" }), h.css({ marginRight: "10px" }), k.css({ marginRight: "10px" }), l.css({ marginRight: "10px" }), m.css({ marginRight: "10px" })) : c && 1601 > n && (f.css({ marginRight: "20px" }), h.css({ marginRight: "20px" }), k.css({ marginRight: "20px" }), l.css({ marginRight: "20px" }), m.css({ marginRight: "20px" })), f.css({ display: "none" }), k.css({ marginBottom: "+=4.2rem" }), a ? l.css({ marginBottom: "+=8.4rem" }) : l.addClass("hidden-element"), b ? m.css({ marginBottom: "+=8.4rem" }) : m.addClass("hidden-element"), $(window).on("scroll",
            function () { $(window).scrollTop() + $(window).height() > $(document).height() - 73 ? (h.addClass("fab_no_overlap_footer_0"), k.addClass("fab_no_overlap_footer_1"), a && l.addClass("fab_no_overlap_footer_2"), b && m.addClass("fab_no_overlap_footer_2")) : (h.removeClass("fab_no_overlap_footer_0"), k.removeClass("fab_no_overlap_footer_1"), a && l.removeClass("fab_no_overlap_footer_2"), b && m.removeClass("fab_no_overlap_footer_2")) }); h.on("click touch", function () { ob(0, null, d) }); if (e) k.on("click touch", function () { ob(1, null, d) });
    else k.addClass("hidden-element"); if (a) l.on("click touch", function () { nb(2, t.get("selectedAccount")) }); if (b) m.on("click touch", function () { let q = t.get("selectedAccount"); T.creditCards.get({ name: q }).then(r => { t.set("selectedCreditCardObj", r); t.set("paymentPageCaller", 2); A(p.url_ccard_payment_modal, "/static/" + (!0 === p.use_min_files ? "js/" + p.js_version + "/modal_card_payment.min.js" : "javascript/secondary_pages/modal_card_payment.js"), $("#modal_container"), {}, !1) }) })
}
function nb(a, b, c) { c = void 0 === c ? null : c; t.set("accountOrCardName", b); t.set("transferPageCaller", a); t.set("transferToDuplicate", c); A(p.url_account_transfer_modal, "/static/" + (!0 === p.use_min_files ? "js/" + p.js_version + "/modal_transfer_btw_accounts.min.js" : "javascript/secondary_pages/modal_transfer_btw_accounts.js"), $("#modal_container"), {}, !1) } function yb() { return g(function* () { return (yield navigator.storage && navigator.storage.persisted) ? navigator.storage.persisted() : void 0 }) }
function zb() { navigator.storage && navigator.storage.persist && navigator.storage.persist().then(a => { void 0 !== a && (a ? E("storagePersisted", 1) : E("storagePersisted", 2)) }) }
function Ya() { g(function* () { if (!navigator.storage || !navigator.storage.persisted) return "never"; var a = yield navigator.storage.persisted(); if (a) return "persisted"; if (!navigator.permissions || !navigator.permissions.query) return "prompt"; a = yield navigator.permissions.query({ name: "persistent-storage" }); if ("granted" === a.state) { if (a = yield navigator.storage.persist()) return E("storagePersisted", 1), "persisted"; throw "error"; } return "prompt" === a.state ? "prompt" : "never" }) }
function Wa() { var a = ""; $(document).on("keydown", function (b) { void 0 !== b.key && ("F5" === b.key ? window.onbeforeunload = ha : "W" === b.key.toUpperCase() && "CONTROL" === a ? window.onbeforeunload = ha : "R" === b.key.toUpperCase() && "CONTROL" === a ? window.onbeforeunload = ha : "F4" !== b.key.toUpperCase() || "ALT" !== a && "CONTROL" !== a || (window.onbeforeunload = ha), a = b.key.toUpperCase()) }); $(window).on("mouseover", function () { window.onbeforeunload = null }); $(window).on("mouseout", function () { window.onbeforeunload = ha }) }
function ha() { let a = firebase.auth().currentUser; a && "function" === typeof Ab && Ab(a.uid); console.log("Reloaded") };/*
 i_p_f. */
var Bb = !0, Cb = 0; window.addEventListener("unhandledrejection", a => { console.warn("UPR"); Cb < Date.now() - 1E4 && (Cb = Date.now(), D(2, "internal_page_frame.js", "unhandledrejection", "UPR: " + a.reason)) });
$(() => {
    if (992 > $(window).width()) {
        Bb = !1; $("#sidebar").addClass("hidden"); $("#page_container").addClass("full"); $("#navbar_top").addClass("full"); if ("false" === M("leftMenuGuideShown", "false")) { E("leftMenuGuideShown", "true"); let b = $("#sidebar_collapse_button"); b.addClass("black_layer_with_hole"); $("#page_container").append("<p class='overlay_text'>" + p.qsg_drawer_burger_icon + "</p>"); $(document).on("click touch", () => { b.removeClass("black_layer_with_hole"); $(".overlay_text").addClass("hidden-element"); $(document).off() }) } document.addEventListener("touchstart",
            Db, !1); document.addEventListener("touchmove", Eb, !1)
    } Fb(0); Gb(); var a = $("#navbutton_dashboard"); A(a.data("html"), a.data("script")); Hb(a); $("#other_support").on("click touch", function () { H($(this).text(), $(this).data("text-2").replace("support@", "support.web@"), null) }); $("#other_sign_out").on("click touch", function () { la() }); S && (a = $("#button_trial_purchase"), a.text(p.subscribe_now), a.on("click touch", function () {
        let b = "/static/" + (!0 === p.use_min_files ? "js/" + p.js_version + "/modal_purchases.min.js" : "javascript/user/modal_purchases.js");
        p.use_min_files || ja("/static/javascript/user/validate_it_fiscal_code.js"); A(p.url_user_select_plan_modal, b, $("#modal_container_with_backdrop"), {}, !1).then(() => { Ib(!0) })
    }), $("#button_back_to_external_page").on("click touch", function () { E("lastSyncTs", null); E("lastSettingsSyncTs", null); E("transactionsSyncFromTs", null); indexedDB.deleteDatabase("fastBudgetDB"); document.location.href = p.url_user_page_external })); ka(); window.addEventListener("popstate", function (b) {
        b.state && A(b.state.html_path, b.state.script_path,
            null, b.state.data, !1)
    }); (window.opr && opr.addons || window.opera || navigator.userAgent && 0 <= navigator.userAgent.indexOf(" OPR/")) && $(".modal-content").addClass("modal-content_opera_only")
});
function Hb(a) {
    let b = $("#sidebar"); (S || M("registration_on_site_date_ms", 0) - 5184E5 > Date.now()) && b.find("i.new_feature").addClass("hidden-element"); a.on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_transactions").on("click touch", function (f) { f.preventDefault(); Jb(this, { transaction_type: W.u }) }); b.find("#navbutton_st").on("click touch", function (f) { f.preventDefault(); Jb(this, { transaction_type: W.A }) }); b.find("#navbutton_accounts").on("click touch", function (f) {
        f.preventDefault();
        Jb(this)
    }); b.find("#navbutton_ccards").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_budgets").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_debts").on("click touch", function (f) { f.preventDefault(); Jb(this) }); let c = !1, d = !1, e = !1; b.find("#navbutton_charts").on("click touch", function (f) { f.preventDefault(); b.find("#charts_dropdown_container").slideToggle(); (c = !c) ? b.addClass("make_scrollable") : e || d || b.removeClass("make_scrollable") }); b.find("#navbutton_charts_categories").on("click touch",
        function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_charts_future").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_charts_forecasts").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_calendar").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_tools").on("click touch", function (f) { f.preventDefault(); b.find("#tools_dropdown_container").slideToggle(); (d = !d) ? b.addClass("make_scrollable") : c || e || b.removeClass("make_scrollable") });
    b.find("#navbutton_tools_import_csv").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_tools_export_csv").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_tools_export_pdf").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_preferences").on("click touch", function (f) { f.preventDefault(); b.find("#pref_dropdown_container").slideToggle(); (e = !e) ? b.addClass("make_scrollable") : c || d || b.removeClass("make_scrollable") }); b.find("#navbutton_pref_cat").on("click touch",
        function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_pref_temp").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_bank_sync").on("click touch", function (f) {
            f.preventDefault(); S ? H(p.bank_sync, p.trial_version + "\n" + p.subscription_required + " (" + p.ultra_plan + ")", p.subscribe_now, !1, () => {
                let h = "/static/" + (!0 === p.use_min_files ? "js/" + p.js_version + "/modal_purchases.min.js" : "javascript/user/modal_purchases.js"); p.use_min_files || ja("/static/javascript/user/validate_it_fiscal_code.js");
                A(p.url_user_select_plan_modal, h, $("#modal_container_with_backdrop"), {}, !1).then(() => { Ib(!0) })
            }) : Jb(this)
        }); b.find("#navbutton_user").on("click touch", function (f) { f.preventDefault(); ja($(this).data("script2")); Jb(this) }); b.find("#navbutton_settings").on("click touch", function (f) { f.preventDefault(); Jb(this) }); b.find("#navbutton_help").on("click touch", function (f) { f.preventDefault(); window.open("https://fastbudget.app/faq/faq-main", "_blank") || window.open("https://fastbudget.app/faq/faq-main", "_self") })
}
function Kb(a, b) { Na = a; let c = $("#sidebar"); c.find("ul li a.active ").removeClass("active"); a = c.find("a[data-page-number=" + a + "]"); a.addClass("active"); $("#navbar_page_title").text(a.data("text")); t.delete("selectedDateNoHour"); Fb(b) }
function Fb(a) { const b = $("#sidebar_collapse_button"); 0 === a ? (b.find("i").html("menu"), b.off("click touch").on("click touch", function (c) { c.stopPropagation(); Lb() })) : (b.find("i").html("arrow_back"), b.off("click touch").on("click touch", function () { $("#nav_button_search").addClass("hidden-element"); history.go(-1); Fb(0) })) }
function Lb() { const a = $("#sidebar"), b = $("#page_container"); a.toggleClass("hidden"); Bb = !a.hasClass("hidden"); if (992 > $(window).width()) { if (b.off(), Bb) b.on("click touch", function (c) { c.stopPropagation(); c.preventDefault(); b.off(); a.toggleClass("hidden"); Bb = !a.hasClass("hidden") }) } else b.toggleClass("full"), $("#navbar_top").toggleClass("full") }
function Jb(a, b) { Ka(200) && (A($(a).data("html"), $(a).data("script"), null, b), $(window).scrollTop($("#main_page_container").offset().top), $("#nav_button_search").addClass("hidden-element"), 992 > $(window).width() && Lb()) } let Mb = null, Nb = null, Ob = null; function Db(a) { a = (a.touches || a.originalEvent.touches)[0]; Mb = a.clientX; Nb = a.clientY; Ob || (a = $(window).width(), Ob = 768 > a ? a / 100 * 30 : a / 100 * 20); !Bb && Mb > Ob && (Mb = Nb = null) }
function Eb(a) { if (Mb && Nb) { var b = Mb - a.touches[0].clientX; Math.abs(b) > Math.abs(Nb - a.touches[0].clientY) && (-8 > b ? Bb || Lb() : 8 < b && Bb && Lb()); Mb = Nb = null } };/*
 d_f. */
function Pb() { let a = T.transactions.clear(), b = T.scheduledTransaction.clear(), c = T.transactionTemplates.clear(), d = T.accounts.clear(), e = T.creditCards.clear(), f = T.budgets.clear(), h = T.categories.clear(), k = T.debts.clear(); return Promise.all([a, b, c, d, e, f, h, k]).then(() => Promise.resolve()) } function Qb(a, b, c, d) { let e = 0; return T.transactions.where(["ei", "date"]).between([a, b], [a, c], !0, !0).each(f => { e = Rb(e, f, d, !1).total }).then(() => Promise.resolve(e)) }
function Sb(a, b, c) { return T.transactions.where(["account", "date"]).between([a, b], [a, 0 < c ? c : 9999999999999], !0, !0).toArray(d => { let e = 0; d.forEach(f => { e = Tb(e, f).total }); return Promise.resolve(e) }) }
function Ub(a, b, c) { if (a.includes(", ")) return new Promise(d => { let e = []; a.split(", ").forEach(f => { let h = 0; f = T.transactions.where(["category", "date"]).between([f, b], [f, c], !0, !0).each(k => { h = Tb(h, k).total }).then(() => Promise.resolve(h)); e.push(f) }); return Promise.all(e).then(f => { f = f.reduce((h, k) => h + k, 0); return d(f) }) }); { let d = 0; return T.transactions.where(["category", "date"]).between([a, b], [a, c], !0, !0).each(e => { d = Tb(d, e).total }).then(() => Promise.resolve(d)) } }
function Tb(a, b) { let c = U.get(b.account); if (null == c || "0" === c[1]) return { total: a, isVisible: !1 }; a = 1 !== c[3] && 0 < c[3] ? a + (0 === parseInt(b.ei) ? -b.value : +b.value) / c[3] : a + (0 === parseInt(b.ei) ? -b.value : +b.value); return { total: a, isVisible: !0 } }
function Rb(a, b, c = !0, d = !1) { if (!d && "Transfer between accounts" === b.category || "CCARD_Monthly_Bill" === b.category || "CCARD_Manual_Bill" === b.category || !c && ("_debt_" === b.category || "_credit_" === b.category)) return { total: a, isVisible: !1 }; c = U.get(b.account); if (null == c || "0" === c[1]) return { total: a, isVisible: !1 }; a = 1 !== c[3] && 0 < c[3] ? a + (0 === parseInt(b.ei) ? -b.value : +b.value) / c[3] : a + (0 === parseInt(b.ei) ? -b.value : +b.value); return { total: a, isVisible: !0 } }
function ib(a) { let b = Pa.get(a), c = !1; b ? b += ".svg" : (c = !0, "Transfer between accounts" === a ? (a = p.transfer_between_accounts, b = "ic_transfer_arrow.svg") : "CCARD_Monthly_Bill" === a ? (a = p.monthly_credit_card_bill, b = "ic_credit_card.png") : "CCARD_Manual_Bill" === a ? (a = p.credit_card_bill, b = "ic_credit_card.png") : "_debt_" === a ? (a = p.debt, b = "ic_cash_debt.png") : "_credit_" === a ? (a = p.credit, b = "ic_cash_credit.png") : (b = "ic_blank_grey.svg", c = !1)); return { categoryCorrectedName: a, iconName: b, isSpecialTransaction: c } }
function Vb() { return T.accounts.toArray(a => { let b = 0; a.forEach(c => { if (1 > c.visibility) return !0; let d = V.get(c.name); isNaN(d) || (b += d / c.exchangeRate) }); return b }) }
function Wb(a, b = 0) { if (!a) return { h: Date.now(), g: Date.now() }; const c = moment(), d = c.get("date"); c.set("date", a.startingDay); a.startingDay > d && c.add(-1, "month"); c.set({ hour: 0, minute: 0, second: 0, millisecond: 0 }); if (0 === b) return a = c.valueOf(), c.add(1, "month"), c.add(-1, "second"), { h: a, g: c.valueOf() }; do c.add(-c.daysInMonth(), "days"), 0 < b ? b-- : b++; while (0 === b); a = c.valueOf(); c.add(-c.daysInMonth(), "days"); c.add(1, "second"); return { h: c.valueOf(), g: a } }
function bb(a) {
    let b = Wb(a, 0), c = 0, d = 0; return T.transactions.where(["account", "date"]).between([a.name, b.h], [a.name, b.g], !0, !0).each(e => { "CCARD_Monthly_Bill" === e.category || "CCARD_Manual_Bill" === e.category ? d += e.value : c += 0 === parseInt(e.ei) ? -e.value : +e.value }).then(() => {
        if (!(0 >= d)) {
            var e = Wb(a, -1), f = 0; return T.transactions.where(["account", "date"]).between([a.name, e.h], [a.name, e.g], !0, !0).each(h => { "CCARD_Monthly_Bill" !== h.category && "CCARD_Manual_Bill" !== h.category && (f += 0 === parseInt(h.ei) ? -h.value : +h.value) }).then(() => { Math.abs(f) !== d && Math.abs(f) < d && (c += d - Math.abs(f)) })
        }
    }).then(() => { V.set(a.name, c) }).catch(() => { V.delete(a.name) })
}
function vb(a, b = 0) {
    var c = moment(); c.set({ hour: 0, minute: 0, second: 0, millisecond: 0 }); let d, e = 0; switch (a.period) {
        case 0: c.add(b, "weeks"); 0 === parseInt(M("firstDayWeek", 0)) ? (d = c.startOf("isoWeek").valueOf(), e = c.endOf("isoWeek").valueOf()) : (d = c.startOf("week").valueOf(), e = c.endOf("week").valueOf()); break; case 1: a = parseInt(M("firstDayMonth", 1)); a > c.date() && c.add(-1, "months"); c.add(b, "months"); c.set("date", a); d = c.valueOf(); c.add(1, "month").add(-1, "millisecond"); e = c.valueOf(); break; case 2: c.add(b, "years");
            c.set({ month: 0, date: 1 }); d = c.valueOf(); c.dayOfYear(c.isLeapYear() ? 366 : 365, "date"); c.add(-1, "millisecond"); e = c.valueOf(); break; case 3: if (0 !== b) c = moment(a.dateFrom), c.add(b * a.durationDays, "days"), d = c.valueOf(), c.add(a.durationDays, "days"), c.set({ hour: 23, minute: 59, second: 59, millisecond: 999 }), e = c.valueOf(); else if (d = a.dateFrom, e = a.dateTo, e < Date.now()) {
                if (0 === a.repeat) return T.budgets.delete(a.id), { h: -1, g: -1 }; b = a.stopDays; for (1 > b && (b = 1); e < Date.now();)c = moment(e), c.set({ hour: 0, minute: 0, second: 0, millisecond: 0 }),
                    c.add(b, "days"), d = c.valueOf(), c.add(0 < a.durationDays ? a.durationDays - 1 : 0, "days"), c.set({ hour: 23, minute: 59, second: 59, millisecond: 999 }), e = c.valueOf(); T.budgets.update(a.id, { h: d, g: e })
            }
    }return { h: d, g: e }
}
function wb(a, b, c) { return "_all_categories_" !== a.category && a.category !== p.all_categories ? Ub(a.category, b, c).then(d => Xb(a.category, b, c).then(e => Promise.resolve(d + e))).then(d => Promise.resolve(0 > d ? -d : 0)).catch(d => { D(3, "data_function.js", "calculateBudgetValue function", d || "?") }) : Qb(0, b, c, !1).then(d => Xb(null, b, c).then(e => Promise.resolve(d + e))).then(d => Promise.resolve(0 > d ? -d : 0)).catch(d => { D(3, "data_function.js", "calculateBudgetValue function", d) }) }
function Xb(a, b, c) { return a ? a.includes(", ") ? new Promise(d => { let e = []; a.split(", ").forEach(f => { f = Yb(f, b, c); e.push(f) }); return Promise.all(e).then(f => { f = f.reduce((h, k) => h + k, 0); return d(f) }) }) : Yb(a, b, c) : Yb(null, b, c) }
function Yb(a, b, c) {
    let d = 0; return (a ? T.scheduledTransaction.where("category").equals(a) : T.scheduledTransaction.where("ei").equals(0)).toArray(e => { e.forEach(f => { let h = 0 === f.numberOfRepeat ? 1E3 : f.numberOfRepeat, k = f.nextDate; const l = moment(k); for (; k < c && 0 < h;) { k > b && (d = Rb(d, f, !1).total); switch (f.period) { case 0: l.add(f.repeatEvery, "days"); break; case 1: l.add(f.repeatEvery, "weeks"); break; case 2: l.add(f.repeatEvery, "months"); break; case 3: l.add(f.repeatEvery, "years"); break; default: return }k = l.valueOf(); h-- } }) }).then(() =>
        Promise.resolve(d))
}
function Zb(a, b, c, d = [], e = !1) {
    let f = 0, h = []; return (2 <= a ? T.scheduledTransaction : T.scheduledTransaction.where("ei").equals(a)).each(k => {
        if (!(null != d && 0 < d.length && 0 > $.inArray(k.category, d))) for (var l = 0 === k.numberOfRepeat ? 1E3 : k.numberOfRepeat, m = k.nextDate, n = moment(m); m < c && 0 < l;) {
            if (m > b) { let q = Rb(f, k, !0, e).total; f !== q && (f = q, k.date = m, h.push(jQuery.extend({}, k))) } switch (k.period) {
                case 0: n.add(k.repeatEvery, "days"); break; case 1: n.add(k.repeatEvery, "weeks"); break; case 2: n.add(k.repeatEvery, "months"); break; case 3: n.add(k.repeatEvery,
                    "years")
            }m = n.valueOf(); l--
        }
    }).then(() => { h.sort((k, l) => k.date - l.date) }).then(() => Promise.resolve([f, h]))
}
function $b(a, b, c, d = !1) {
    if (0 > b.numberOfRepeat) return T.scheduledTransaction.delete(b.id), Promise.resolve(); a || (a = firebase.auth().currentUser); 0 === c && (c = moment(), c.set({ hour: 23, minute: 59, second: 59 }), c = c.valueOf()); let e = 0 === b.numberOfRepeat ? 9 : b.numberOfRepeat, f = b.nextDate; const h = moment(f); let k = 0, l = []; for (; (d || f < c) && 0 < e;) {
        2 > b.ei ? l.push(ac(a, b, d ? Date.now() : f)) : l.push(bc(a, b, d ? Date.now() : f)); switch (b.period) {
            case 0: h.add(b.repeatEvery, "days"); break; case 1: h.add(b.repeatEvery, "weeks"); break; case 2: h.add(b.repeatEvery,
                "months"); break; case 3: h.add(b.repeatEvery, "years")
        }f = h.valueOf(); e--; k++; if (d) break
    } return Promise.all(l).then(() => cc(a, b, f, k))
}
function cc(a, b, c, d) {
    a = firebase.database().ref("usersDatabase/" + a.uid + "/scheduledTransactions"); 0 === b.numberOfRepeat ? c = { nextDate: c, ts: firebase.database.ServerValue.TIMESTAMP } : 0 < b.numberOfRepeat - d ? c = { numberOfRepeat: b.numberOfRepeat - d, nextDate: c, ts: firebase.database.ServerValue.TIMESTAMP } : 0 >= b.reminderDiffTime ? c = { state: 1, nextDate: c, ts: firebase.database.ServerValue.TIMESTAMP } : (T.scheduledTransaction.delete(b.id), c = { numberOfRepeat: -1, nextDate: c, ts: firebase.database.ServerValue.TIMESTAMP }); return a.child(b.id).update(c).catch(function (e) {
        D(3,
            "data_functions.js", "Editing ST after a tr creation: " + b.toString().substring(b.root.toString().length), e)
    })
}
function ac(a, b, c) {
    let d = U.get(b.account); if (d && d[4]) return Promise.resolve(); const e = { category: b.category, account: b.account, fromTo: null != b.fromTo ? b.fromTo : "", notes: null != b.notes ? b.notes : "", photoName: null != b.photoName ? b.photoName : "", addedFrom: "", ei: b.ei, value: b.value, date: c, checked: 1 }, f = firebase.database().ref("usersDatabase/" + a.uid + "/transactions"), h = b.id + "*S" + c.toString(); return T.transactions.where("id").equals(h).count(k => {
        if (0 < k) return Promise.resolve(); k = V.get(b.account); if (null != k) {
            var l = k +
                (0 === e.ei ? -1 : 1) * e.value; k = dc(e); return f.child(h).update(k).then(() => Y(a, e.account, l)).catch(function (m) { D(3, "data_functions.js", "Saving transaction from ST: " + f.toString().substring(f.root.toString().length), m) })
        }
    }).catch(function (k) { D(3, "data_functions.js", "Checking if transaction exist in locale: " + f.toString().substring(f.root.toString().length), k) })
}
function bc(a, b, c) {
    let d = b.account, e = b.fromTo, f = U.get(d), h = U.get(e), k = 1; parseFloat(f[3]) !== parseFloat(h[3]) && (k = 1 / parseFloat(f[3]) * parseFloat(h[3])); const l = firebase.database().ref("usersDatabase/" + a.uid + "/transactions"), m = { category: b.category, account: d, fromTo: e, notes: null != b.notes ? b.notes : "", photoName: null != b.photoName ? b.photoName : "", addedFrom: "", ei: 0, value: b.value, date: c, checked: 1 }, n = {
        category: b.category, account: e, fromTo: d, notes: null != b.notes ? b.notes : "", photoName: null != b.photoName ? b.photoName : "",
        addedFrom: "", ei: 1, value: b.value * k, date: c, checked: 1
    }, q = b.id + "*S" + c.toString() + "-S", r = b.id + "*S" + c.toString() + "-T"; return T.transactions.where("id").equals(q).count(u => {
        if (0 < u) return Promise.resolve(); u = V.get(d); if (null != u) {
            var v = u - b.value; u = V.get(e); if (null != u) {
                var z = u + b.value * k; u = dc(m); var K = dc(n); return l.child(q).update(u).then(() => l.child(r).update(K)).then(() => { let L = Y(a, d, v), Q = Y(a, e, z); return Promise.resolve(L, Q) }).catch(function (L) {
                    D(3, "data_functions.js", "Saving transfer from ST: " + l.toString().substring(l.root.toString().length),
                        L)
                })
            }
        }
    }).catch(function (u) { D(3, "data_functions.js", "Checking if transaction exist in locale: " + l.toString().substring(l.root.toString().length), u) })
}; function ec(a, b, c, d = !0, e = !0, f = !0, h, k = !1, l = null) {
    a.empty(); a.removeClass("is-invalid"); f ? (a.prop("disabled", !1), a.off("select2:select").on("select2:select", function (n) { (n = n.params.data.account) && h && h(n.name !== p.all_accounts ? n : null) }), a.off("keyup").on("keyup", function (n) { n = n.keyCode || n.which; 13 !== n && 9 !== n || a.select2("open") })) : a.prop("disabled", !0); let m = []; k && (k = { name: p.all_accounts, isoCurrency: M("defCurrencyAndSign", "EUR - \u20ac"), exchangeRate: 1 }, fc(m, k, c, h)); k = Promise.resolve(); d && (k = T.creditCards.orderBy("position").toArray(n => { n.forEach(q => { f && (1 < q.visibility || l && q.name === l) || fc(m, q, c, h) }) })); k.then(() => T.accounts.orderBy("position").toArray(n => { n.forEach(q => { f && (!e && q.bsId || 0 > q.visibility || 1 < q.visibility || l && q.name === l) || fc(m, q, c, h) }) })).then(() => { gc(a, b, m) })
} function fc(a, b, c, d) { let e = { id: b.name, text: b.name, account: b }; c ? c === b.name && (e.selected = !0, d && d(b.name !== p.all_accounts ? b : null)) : 0 === a.length && (e.selected = !0, d && d(b.name !== p.all_accounts ? b : null)); a.push(e) }
function gc(a, b, c) { a.select2({ dropdownParent: b, data: c, selectOnClose: !0, placeholder: p.select_account, templateResult: hc, minimumResultsForSearch: 10, matcher: (d, e) => "" === $.trim(d.term) || e.id.toLowerCase().startsWith(d.term.toLowerCase()) ? e : null, language: { noResults: () => "-" }, dir: "rtl" === document.dir ? "rtl" : "ltr" }) }
function hc(a) { if (!a.id) return "error"; var b = V.get(a.id); let c = a.account.isoCurrency.split("-")[0].trim(); b = null != b ? x(parseFloat(b), w, c ? c : R) : "-"; return $("<div class='d-flex align-items-center'>  <div class='big_text_2'>" + a.text + "</div>  <div class='ml-auto'>" + b + "</div></div>") }
function ic(a, b, c, d, e) {
    a.empty(); !e && d ? (a.append("<option value='" + d + "' selected>" + d + "</option>"), a.prop("disabled", !0), a.addClass("is_hint")) : (a.prop("disabled", !1), a.removeClass("is_hint"), a.append("<option> </option>"), a.off("keyup").on("keyup", function (f) { f = f.keyCode || f.which; 13 !== f && 9 !== f || a.select2("open") }), c.forEach(f => { f && (d && d === f ? a.append("<option value='" + f + "' selected>" + f + "</option>") : a.append("<option value='" + f + "'>" + f + "</option>")) }), a.select2({
        dropdownParent: b, selectOnClose: !0, tags: !0,
        placeholder: p.optional, insertTag: function (f, h) { f.splice(0, 0, h) }, language: { noResults: () => "-" }, dir: "rtl" === document.dir ? "rtl" : "ltr"
    }), a.off("select2:open").on("select2:open", function () { let f = a.val(); f && $(".select2-container").find(".select2-search__field").val(f.trim()) }))
};/*
 m_a_t */
let Z, jc, kc, lc = !1, mc, nc = null; function ob(a, b, c) { b = void 0 === b ? null : b; Z = a; jc = null; kc = void 0 === c ? !1 : c; X().then(() => { oc(null != b && null != b.account ? b : null) }) }
function oc(a) {
    const b = ra(1, "modal_add_transaction"); b.find("#input_new_tr_waiting").addClass("hidden-element"); var c = !0, d = !0, e = !0, f = !0; let h = !0, k = null != t.get("debtObjToRepay") || null != a && ("_debt_" === a.category || "_credit_" === a.category); b.find("#new_tr_budget_amount_left").text(""); if (null != a) {
        null != a.id ? (jc = a.id, kc && (a.date = a.nextDate)) : a.date = null; var l = U.get(a.account); if (a.bsId || l && l[4]) c = e = f = !1; else if ("Transfer between accounts" === a.category) d = e = h = !1; else if ("CCARD_Monthly_Bill" === a.category ||
            "CCARD_Manual_Bill" === a.category) c = e = d = h = !1; else if ("_debt_" === a.category || "_credit_" === a.category) d = h = !1
    } else if (a = {}, k) d = h = !1, l = t.get("debtObjToRepay"), a.value = 0 < l.value - l.repaidAmount ? l.value - l.repaidAmount : 0, a.category = 0 === Z ? "_debt_" : "_credit_", a.account = l.account, a.fromTo = l.fromTo, l = U.get(a.account), b.find("#new_tr_budget_amount_left").text(p.residual_amount + " " + x(a.value, w, l ? l[0] : R)); else if (a.category = t.get("selectedCategory"), a.account = t.get("selectedAccount"), 9 === Na && null != t.get("selectedDateNoHour")) {
        l =
            moment(t.get("selectedDateNoHour")); let q = moment(); a.date = l.set({ hour: q.hour(), minute: q.minute() }).valueOf()
    } l = null != jc ? p.modify_transaction : k ? p.payback + "(" + (0 === Z ? p.debt : p.credit) + ")" : 0 === Z ? p.new_expense : p.new_income; b.find("#modal_add_transaction_title").text(l); 0 === Z ? (b.find("input.form-control").addClass("red").removeClass("green"), b.find("#input_new_tr_notes").addClass("red").removeClass("green")) : (b.find("input.form-control").addClass("green").removeClass("red"), b.find("#input_new_tr_notes").addClass("green").removeClass("red"));
    l = $("#i_add_tr_select_template"); null != jc || k ? l.addClass("hidden-element") : (l.removeClass("hidden-element"), l.off("click touch").on("click touch", function () { pc() })); l = b.find("#input_new_tr_value"); Ma(l, a.value); c ? (l.prop("disabled", !1), l.removeClass("is_hint cursor_default")) : (l.prop("disabled", !0), l.addClass("is_hint cursor_default")); c = b.find("#new_tr_value_currency"); c.css("padding-bottom", 0); c.text(M("defCurrencySign", "\u20ac")); l = b.find("#input_new_tr_category"); l.removeClass("is-invalid"); null !=
        a.category ? (c = ib(a.category), qc(c.categoryCorrectedName, c.iconName, 0 === Z && !k)) : (l.val(p.select_category), l.data("category-name", null), $("#new_tr_category_icon").attr("src", "/static/icons/ic_blank_grey.svg")); d ? (l.off("click touch").on("click touch", function () { rc(0, Z) }), l.on("keyup", function (q) { q = q.keyCode || q.which; 13 !== q && 9 !== q || rc(0, Z) }), null == a.category ? l.addClass("is_hint") : l.removeClass("is_hint"), l.prop("disabled", !1)) : l.prop("disabled", !0); ec(b.find("#select_new_tr_account"), b, a.account, 0 ===
            Z, !1, e, sc); mc = a.date ? moment(a.date) : moment(); d = moment.localeData(p.country_code_2l); l = b.find("#input_new_tr_date"); l.removeClass("is-invalid"); l.val(""); l.bootstrapMaterialDatePicker({ lang: w, time: !1, switchOnClick: !0, weekStart: d.firstDayOfWeek(), format: d.longDateFormat("L"), minDate: moment().subtract(10, "y"), maxDate: moment().add(5, "y"), okText: p.ok, cancelText: p.back }); l.bootstrapMaterialDatePicker("setDate", mc); l.on("change", function (q, r) { mc.set({ year: r.year(), month: r.month(), date: r.date() }) }); f ? (l.prop("disabled",
                !1), l.removeClass("is_hint cursor_default")) : (l.prop("disabled", !0), l.addClass("is_hint cursor_default")); "false" === M("useTransactionHour", "false") || kc ? b.find("#input_new_tr_time").parent().addClass("hidden-element") : (l = b.find("#input_new_tr_time"), l.removeClass("is-invalid"), l.val(""), l.bootstrapMaterialDatePicker({ lang: w, date: !1, format: "HH:mm", switchOnClick: !0 }), l.bootstrapMaterialDatePicker("setDate", mc), l.on("change", function (q, r) { mc.set({ hour: r.hour(), minute: r.minute() }) }), f ? (l.prop("$disabled",
                    !1), l.removeClass("is_hint cursor_default")) : (l.prop("$disabled", !0), l.addClass("is_hint cursor_default"))); b.find("#label_new_tr_from_to").text((0 === Z ? p.to_colon : p.from_colon).replace(":", "")); const m = b.find("#select_new_tr_from_to"); m.empty(); T.transactions.where(["ei", "date"]).between([Z, Date.now() - 31536E6], [Z, 9999999999999], !0, !0).toArray(q => {
                        let r = new Set; q.forEach(u => { "Transfer between accounts" !== u.category && "CCARD_Monthly_Bill" !== u.category && "CCARD_Manual_Bill" !== u.category && r.add(u.fromTo) });
                        T.transactionTemplates.where("ei").equals(Z).toArray(u => { u.forEach(v => { r.add(v.fromTo) }); ic(m, b, r, a.fromTo, h) })
                    }); Ma(b.find("#input_new_tr_notes"), a.notes); kc ? $("#new_tr_checked").addClass("hidden-element") : (f = M("defTrStatus", "0"), d = $("#new_tr_checked"), "2" === f ? (d.parent().addClass("hidden-element"), d.prop("checked", !0)) : (d.parent().removeClass("hidden-element"), a.checked ? d.prop("checked", 1 !== a.checked) : d.prop("checked", "1" !== f))); tc(b, a); nc = null; l = b.find("#input_new_tr_photo_upload"); l.val(null);
    l.removeClass("is-invalid"); let n = b.find("#img_new_tr_photo_img_container"); n.addClass("hidden-element"); f = b.find("#button_new_tr_enable_drx"); if (M("dbx_at", null)) if (f.addClass("hidden-element"), a.photoName) {
        nc = a.photoName; b.find("#new_tr_photo_upload_container").addClass("hidden-element"); f = n.find("img"); d = b.find("#new_tr_photo_not_found"); let q = n.find("button"); q.addClass("hidden-element"); 0 === Z ? q.addClass("btn_red").removeClass("btn_green") : q.addClass("btn_green").removeClass("btn_red"); q.off("click touch").on("click touch",
            function () { nc = "-"; b.find("#new_tr_photo_upload_container").removeClass("hidden-element"); n.addClass("hidden-element") }); lb(a.photoName, f, d).then(() => { n.removeClass("hidden-element"); q.removeClass("hidden-element") }).catch(() => { nc = null; n.addClass("hidden-element"); b.find("#new_tr_photo_upload_container").removeClass("hidden-element") })
    } else b.find("#new_tr_photo_upload_container").removeClass("hidden-element"); else b.find("#new_tr_photo_upload_container").addClass("hidden-element"), f.removeClass("hidden-element"),
        f.off("click touch").on("click touch", function () { uc() }); f = b.find("#button_add_transaction_cancel"); d = b.find("#button_add_transaction_save"); e = b.find("#button_add_transaction_save_new"); 0 === Z ? (f.addClass("btn_red").removeClass("btn_green"), d.addClass("btn_red").removeClass("btn_green"), e.addClass("btn_red").removeClass("btn_green")) : (f.addClass("btn_green").removeClass("btn_red"), d.addClass("btn_green").removeClass("btn_red"), e.addClass("btn_green").removeClass("btn_red")); f.off("click touch").on("click touch",
            function () { t.set("debtObjToRepay", null); t.set("selectedDateNoHour", null); b.modal("hide") }); d.prop("disabled", !1); d.off("click touch").on("click touch", function () { lc = !1; vc() }); null != jc || k || kc ? e.addClass("hidden-element") : (e.removeClass("hidden-element"), e.prop("disabled", !1), e.off("click touch").on("click touch", function () { lc = !0; vc() })); b.modal("show")
}
function tc(a, b) {
    if (kc) {
        a.find("#add_st_fields_container").removeClass("hidden-element"); var c = a.find("#input_new_st_repeats_every"); Ma(c, void 0 !== b.repeatEvery ? b.repeatEvery.toString() : null); var d = a.find("#select_new_st_repeats_type"); d.height(c.height()); d.html(""); d.append($("<option></option>").attr("value", 0).text(p.days)); d.append($("<option></option>").attr("value", 1).text(p.weeks)); d.append($("<option></option>").attr("value", 2).text(p.months)); d.append($("<option></option>").attr("value",
            3).text(p.years)); d.val(void 0 !== b.period ? b.period : 2); c = a.find("#input_new_st_n_times"); Ma(c, void 0 !== b.numberOfRepeat ? b.numberOfRepeat.toString() : null)
    } else a.find("#add_st_fields_container").addClass("hidden-element")
}
function qc(a, b, c) { c = void 0 === c ? !1 : c; if (b) { let d = $("#input_new_tr_category"); d.val(a); d.data("category-name", a); d.removeClass("is_hint is-invalid"); d.trigger("focus"); 0 > b.indexOf(".svg") && 0 > b.indexOf(".png") && (b += ".svg"); $("#new_tr_category_icon").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + b) } 0 === Z && c && wc(a) }
function sc(a) { a && ($("#new_tr_value_currency").text(a.isoCurrency.split("-")[1].trim()), 0 === Z && (a = $("#input_new_tr_category").data("category-name"), null != a && wc(a))) }
function xc(a) { if (0 < a.value) { var b = $("#input_new_tr_value"); b.val(a.value); b.removeClass("is-invalid") } b = Pa.get(a.category); qc(a.category, b, !0); $("#select_new_tr_account").val(a.account).trigger("change.select2"); (b = U.get(a.account)) && ("0" === b[2] ? T.accounts.get({ name: a.account }) : T.creditCards.get({ name: a.account })).then(c => { null != c && sc(c) }); b = $("#select_new_tr_from_to"); b.val(a.fromTo).trigger("change"); b.removeClass("is-invalid"); b = $("#input_new_tr_notes"); b.val(a.notes); b.removeClass("is-invalid") }
function wc(a) {
    if (0 === Z) {
        var b = $("#new_tr_budget_amount_left"); b.text(""); T.budgets.toArray(c => {
            if (0 !== c.length) {
                var d = null, e = []; c.forEach(f => {
                    if (!(2 === f.period || 3 === f.period && 7776E6 < f.dateTo - f.dateFrom)) {
                        if (f.category.includes(", ")) { if (!(f.category.startsWith(a) || f.category.endsWith(a) || f.category.includes(", " + a + ", "))) return } else if (f.category !== a) return; var h = vb(f, 0); -1 !== h.g && (h = wb(f, h.h, h.g).then(k => {
                            null == d ? (d = f, d.remainingAmount = f.maxValue - k) : d.remainingAmount > f.maxValue - k && (d = f, d.remainingAmount =
                                f.maxValue - k)
                        }), e.push(h))
                    }
                }); Promise.all(e).then(() => {
                    if (null != d) {
                        var f = $("#select_new_tr_account").val(); if (f) {
                            let h = U.get(f); if (h) {
                                ("0" === h[2] ? T.accounts.get({ name: f }) : T.creditCards.get({ name: f })).then(k => { null == k || k.isoCurrency.split("-")[0].trim() === R || isNaN(k.exchangeRate) || 0 >= k.exchangeRate ? b.html(p.residual_amount_long + " " + x(d.remainingAmount, w, R) + "<br>(" + d.name + ")") : b.html(p.residual_amount_long + " " + x(d.remainingAmount * k.exchangeRate, w, k.isoCurrency.split("-")[0].trim()) + "<br>(" + d.name + ")") });
                                return
                            }
                        } b.html(p.residual_amount_long + " " + x(d.remainingAmount, w, R) + "<br>(" + d.name + ")")
                    }
                })
            }
        })
    }
}
function vc() {
    g(function* () {
        var a = !1, b = $("#input_new_tr_value"); const c = parseFloat(b.val()); Number.isNaN(c) || 0 >= c || 999999999999 < c ? (b.addClass("is-invalid"), $("#new_tr_value_currency").css("padding-bottom", $("#input_new_tr_value_error_msg").outerHeight(!0)), a = !0) : (b.removeClass("is-invalid"), $("#new_tr_value_currency").css("padding-bottom", 0)); b = $("#input_new_tr_category"); var d = b.data("category-name"); null == d || 2 > d.length || 150 < d.length ? (b.addClass("is-invalid"), a = !0) : null == Pa.get(d) ? d === p.transfer_between_accounts ?
            d = "Transfer between accounts" : d === p.monthly_credit_card_bill ? d = "CCARD_Monthly_Bill" : d === p.credit_card_bill ? d = "CCARD_Manual_Bill" : d === p.debt ? d = "_debt_" : d === p.credit ? d = "_credit_" : (b.addClass("is-invalid"), a = !0) : b.removeClass("is-invalid"); b = $("#select_new_tr_account"); const e = b.val(); O(b, e, 2, 149, null) || (a = !0); kc && mc.set({ hour: 6, minute: 0, second: 0, millisecond: 0 }); const f = mc.valueOf(); b = $("#input_new_tr_date"); 0 === f ? (b.addClass("is-invalid"), a = !0) : b.removeClass("is-invalid"); if (kc) {
                var h = moment(); h.set({
                    hour: 0,
                    minute: 0, second: 0, millisecond: 0
                }); f < h.valueOf() && (b.addClass("is-invalid"), B(p.scheduled_transaction, p.scheduled_transaction_past), a = !0)
            } b = $("#select_new_tr_from_to"); h = b.val(); O(b, h, 0, 199, null) || (a = !0); b = $("#input_new_tr_notes"); const k = b.val(); O(b, k, 0, 999, null) || (a = !0); b = {}; if (kc && (b = yc(), b.error)) return; if (!a) {
                $("#button_add_transaction_save").prop("disabled", !0); $("#button_add_transaction_save_new").prop("disabled", !0); $("#input_new_tr_waiting").removeClass("hidden-element"); a = $("#input_new_tr_photo_upload");
                var l = a.prop("files")[0]; if (l) { if (nc = l.name, l = $("#input_new_tr_photo_error_msg"), !(yield zc(a, l).catch(() => { $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled", !1); $("#button_add_transaction_save_new").prop("disabled", !1); nc = null; return Promise.resolve(!1) }))) return } else a.removeClass("is-invalid"); if (kc) d = {
                    category: d, account: e, fromTo: h ? h.trim() : null, notes: k, ei: Z, value: c, nextDate: f, numberOfRepeat: b.J, period: b.M, repeatEvery: b.N, reminderDiffTime: 0,
                    state: 0, ts: firebase.database.ServerValue.TIMESTAMP
                }, nc && (d.photoName = "-" !== nc ? nc : ""), Ac(d); else {
                    b = $("#new_tr_checked").is(":checked") ? 0 : 1; var m = { category: d, account: e, fromTo: h, notes: k, ei: Z, value: c, date: f, checked: b }; nc && (m.photoName = "-" !== nc ? nc : ""); if (null == jc || "" === jc) m.addedFrom = p.app_name + " Web"; d = U.get(e); null != d && "1" === d[2] ? T.creditCards.get({ name: e }).then(n => {
                        V.get(e) + c > n.limit ? (B(p.error, p.limit_reached), $("#button_add_transaction_save").prop("disabled", !1), $("#button_add_transaction_save_new").prop("disabled",
                            !1)) : S ? Bc(m) : Cc(m)
                    }) : S ? Bc(m) : Cc(m)
                }
            }
    })
}
function Cc(a, b, c) {
    b = void 0 === b ? !0 : b; c = void 0 === c ? !0 : c; $("#input_new_tr_waiting").removeClass("hidden-element"); if (!V.has(a.account)) { if (c) return X().then(() => Cc(a, b, !1)); B(); return Promise.reject() } const d = firebase.auth().currentUser, e = firebase.database().ref("usersDatabase/" + d.uid + "/transactions"); let f; if (null == jc || "" === jc) f = e.push().key; else return "Transfer between accounts" === a.category ? Dc(a, d, e) : Ec(a, d, e); let h = V.get(a.account) + (0 === a.ei ? -1 : 1) * a.value; G("lastTransactionAction", Date.now()); c =
        dc(a); return e.child(f).update(c).then(() => {
            if ("_debt_" === a.category || "_credit_" === a.category) {
                let k = t.get("debtObjToRepay"); k.relatedTransactionIds = null == k.relatedTransactionIds ? f : k.relatedTransactionIds + "$" + f; let l = k.repaidAmount; if (Number.isNaN(l) || 0 > l) l = 0; if (k.account === a.account) l += a.value; else { let m = U.get(k.account), n = U.get(a.account); l = m[3] === n[3] ? l + a.value : l + a.value / n[3] * m[3] } if (Number.isNaN(l) || 0 > l) l = 0; firebase.database().ref("usersDatabase/" + d.uid + "/debts/" + k.id).update({
                    relatedTransactionIds: k.relatedTransactionIds,
                    repaidAmount: l, ts: firebase.database.ServerValue.TIMESTAMP
                })
            } return Y(d, a.account, h)
        }).then(() => { gtag("event", "create_transaction", { event_category: "engagement" }); b && (setTimeout(function () { Fc() }, 500), 1 > parseInt(M("storagePersisted", 0)) && yb().then(k => { void 0 !== k && (k || zb()) })) }).catch(function (k) {
            $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled", !1); $("#button_add_transaction_save_new").prop("disabled", !1); B(); D(3, "modal_add_transaction.js", "Saving transaction: " +
                e.toString().substring(e.root.toString().length), k)
        })
}
function Bc(a, b, c) {
    b = void 0 === b ? !0 : b; c = void 0 === c ? !0 : c; $("#input_new_tr_waiting").removeClass("hidden-element"); if (!V.has(a.account)) { if (c) return X().then(() => Bc(a, b, !1)); B(); return Promise.reject() } c = !0; let d; null == jc || "" === jc ? (d = "tr" + Date.now(), c = !1) : d = jc; a.id = d; a.state = null; a.ts = null; return c ? T.transactions.get(jc).then(e => T.transactions.put(a).then(() => {
        var f = V.get(a.account) + (0 === a.ei ? -1 : 1) * a.value; Y(null, a.account, f); f = V.get(e.account) + (0 === e.ei ? 1 : -1) * e.value; Y(null, e.account, f); gtag("event",
            "edit_transaction", { event_category: "engagement" }); b && Fc()
    })) : T.transactions.put(a).then(() => {
        if ("_debt_" === a.category || "_credit_" === a.category) {
            var e = t.get("debtObjToRepay"); e.relatedTransactionIds = null == e.relatedTransactionIds ? d : e.relatedTransactionIds + "$" + d; let f = e.repaidAmount; if (Number.isNaN(f) || 0 > f) f = 0; if (e.account === a.account) f += a.value; else { let h = U.get(e.account), k = U.get(a.account); f = h[3] === k[3] ? f + a.value : f + a.value / k[3] * h[3] } if (Number.isNaN(f) || 0 > f) f = 0; T.debts.update(e.id, {
                relatedTransactionIds: e.relatedTransactionIds,
                repaidAmount: f
            })
        } e = V.get(a.account) + (0 === a.ei ? -1 : 1) * a.value; Y(null, a.account, e); gtag("event", "create_transaction", { event_category: "engagement" }); b && Fc()
    })
}
function Ec(a, b, c) {
    let d = V.get(a.account); return null == d ? (B(null, null), Promise.reject()) : T.transactions.get(jc).then(e => [e.value, e.account]).then(e => { let f = e[0]; e = e[1]; if (e === a.account) return 0 === a.ei ? { "new": [a.account, d + f - a.value, d], old: [null, 0, 0], oldTransactionValue: f } : { "new": [a.account, d - f + a.value, d], old: [null, 0, 0], oldTransactionValue: f }; { let h = V.get(e); return 0 === a.ei ? { "new": [a.account, d - a.value, d], old: [e, h + f, h], oldTransactionValue: f } : { "new": [a.account, d + a.value, d], old: [e, h - f, h], oldTransactionValue: f } } }).then(e => {
        G("lastTransactionAction", Date.now()); let f = dc(a); c.child(jc).update(f).then(() => {
            var h = e["new"]; Y(b, h[0], h[1]); h = e.old; null != h[0] && Y(b, h[0], h[1]); "_debt_" !== a.category && "_credit_" !== a.category || a.value === e.K || T.debts.toArray(k => {
                for (var l = 0; l < k.length; l++) {
                    let n = k[l]; var m = n.relatedTransactionIds; if (null != m && m.includes(jc) && (0 === n.type && 0 === a.ei || 1 === n.type && 1 === a.ei)) {
                        k = a.value - e.K; a.account !== n.account && (l = U.get(n.account), m = U.get(a.account), l[3] !== m[3] && (k = k / m[3] * l[3])); l = n.repaidAmount; if (Number.isNaN(l) ||
                            0 > l) l = 0; l += k; if (Number.isNaN(l) || 0 > l) l = 0; firebase.database().ref("usersDatabase/" + b.uid + "/debts/" + n.id).update({ repaidAmount: l, state: 0, ts: firebase.database.ServerValue.TIMESTAMP }); break
                    }
                }
            })
        }).then(() => { gtag("event", "edit_transaction", { event_category: "engagement" }); setTimeout(function () { Fc() }, 500) }).catch(function (h) {
            $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled", !1); $("#button_add_transaction_save_new").prop("disabled", !1); B(); D(3, "modal_add_transaction.js",
                "Edit transaction: " + c.toString().substring(c.root.toString().length), h)
        })
    })
}
function Dc(a, b, c) {
    return g(function* () {
        let d = yield T.transactions.get(jc).then(q => q.value), e = a.value !== d, f = V.get(a.account); if (null == f) return B(null, null), Promise.reject(); var h = a.fromTo; let k = yield T.transactions.where(["account", "date"]).between([h, a.date], [h, a.date], !0, !0).toArray(q => { let r = null; q.forEach(u => { "Transfer between accounts" === u.category && a.ei !== u.ei && (r = u) }); return r }), l, m; k && (e && (m = k.value, l = V.get(k.account), k.value = d === m ? a.value : m / d * a.value), k.notes = a.notes, k.photoName = a.photoName,
            k.checked = a.checked); G("lastTransactionAction", Date.now()); h = []; var n = dc(a); h[0] = c.child(jc).update(n); k && (n = dc(k), h[1] = c.child(k.id).update(n)); Promise.all(h).then(() => { e && (Y(b, a.account, 0 === a.ei ? f + d - a.value : f + a.value - d), void 0 !== l && Y(b, k.account, 0 === k.ei ? l + m - k.value : l + k.value - m)) }).then(() => { gtag("event", "edit_transaction", { event_category: "engagement" }); setTimeout(function () { Fc() }, 500) }).catch(function (q) {
                $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled",
                    !1); $("#button_add_transaction_save_new").prop("disabled", !1); B(); D(3, "modal_add_transaction.js", "Edit transfer tr: " + c.toString().substring(c.root.toString().length), q)
            })
    })
}
function yc() { let a = !1, b = $("#input_new_st_repeats_every"); const c = parseInt(b.val()); Number.isNaN(c) || 0 >= c || 99999 < c ? (b.addClass("is-invalid"), a = !0) : b.removeClass("is-invalid"); b = $("#select_new_st_repeats_type"); const d = parseInt(b.val()); 0 > d || 3 < d ? (b.addClass("is-invalid"), a = !0) : b.removeClass("is-invalid"); b = $("#input_new_st_n_times"); const e = parseInt(b.val()); Number.isNaN(e) || 0 > e || 99999 < e ? (b.addClass("is-invalid"), a = !0) : b.removeClass("is-invalid"); return { error: a, J: e, M: d, N: c } }
function Ac(a) {
    if (2 === a.ei) $("#input_new_tr_waiting").addClass("hidden-element"), B(null, "Not yet handled"); else {
        var b = moment(a.nextDate), c = moment(); if (b.date() === c.date() && b.month() === c.month() && b.year() === c.year()) {
            c = { category: a.category, account: a.account, fromTo: a.fromTo, notes: a.notes, addedFrom: "Web app", photoName: a.photoName || "", ei: Z, value: a.value, date: Date.now(), state: 0, ts: firebase.database.ServerValue.TIMESTAMP }; S ? Bc(c, !1, !0) : Cc(c, !1, !0); if (1 < a.numberOfRepeat) --a.numberOfRepeat; else if (1 === a.numberOfRepeat) {
                setTimeout(function () { Fc() },
                    500); return
            } switch (a.period) { default: case 0: b.add(a.repeatEvery, "days"); break; case 1: b.add(a.repeatEvery, "weeks"); break; case 2: b.add(a.repeatEvery, "months"); break; case 3: b.add(a.repeatEvery, "years") }a.nextDate = parseInt(b.valueOf())
        } if (S) a.id = "st" + Date.now(), a.state = null, a.ts = null, T.scheduledTransaction.put(a).then(() => g(function* () {
            jc ? (yield T.scheduledTransaction.delete(jc).catch(d => { D(3, "page_transactions.js", "Trial - Delete scheduled transaction after edit", d) }), gtag("event", "edit_scheduled_tr",
                { event_category: "engagement" })) : gtag("event", "create_scheduled_tr", { event_category: "engagement" }); Fc()
        })).catch(d => { $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled", !1); $("#button_add_transaction_save_new").prop("disabled", !1); B(); D(3, "modal_add_transaction.js", "Trial - Saving scheduled transaction", d) }); else {
            b = firebase.auth().currentUser; const d = firebase.database().ref("usersDatabase/" + b.uid + "/scheduledTransactions"); d.push().update(a).then(() =>
                g(function* () { if (jc) { const e = { state: 1, ts: firebase.database.ServerValue.TIMESTAMP }; yield d.child(jc).update(e).catch(f => { D(3, "page_transactions.js", "Delete scheduled transaction after edit", f) }); gtag("event", "edit_scheduled_tr", { event_category: "engagement" }) } else gtag("event", "create_scheduled_tr", { event_category: "engagement" }); setTimeout(function () { Fc() }, 500) })).catch(function (e) {
                    $("#input_new_tr_waiting").addClass("hidden-element"); $("#button_add_transaction_save").prop("disabled", !1); $("#button_add_transaction_save_new").prop("disabled",
                        !1); B(); D(3, "modal_add_transaction.js", "Saving scheduled transaction: " + d.toString().substring(d.root.toString().length), e)
                })
        }
    }
}
function Fc() { $("#input_new_tr_waiting").addClass("hidden-element"); lc ? (lc = !1, oc(null)) : $("#modal_add_transaction").modal("hide"); switch (Na) { case 0: populateOverviewPage(); break; case 1: case 3: case 5: populateTransactionList(); break; case 2: populateScheduledTransactionList(Z); break; case 4: 0 < $("#list_ccards").length ? populateCardsPageList(!1) : populateTransactionList(); break; case 6: populateDebtsList(!1); "function" === typeof populateTransactionList && populateTransactionList(); break; case 9: setCalendarPage(!0) } }
;/*
 m_l. */
var Gc = new Set, Hc = new Set; function rc(a, b) { $("#modal_item_list_title").text(p.select_category); Gc.clear(); Hc.clear(); Ic(!0, a, b, 0) } function Jc(a, b, c) { c = void 0 === c ? null : c; $("#modal_item_list_title").text(p.select_category); Gc.clear(); Hc.clear(); c && c.split(", ").forEach(d => { Hc.add(d) }); Ic(!0, a, b, 1) }
function Ic(a, b, c, d) {
    const e = ra(2, "modal_item_list"), f = e.find("#modal_item_list_container"); f.empty(); if (2 > c) var h = T.categories.where("parentId").equals("").sortBy("position"); else { h = T.categories.where("parentId").equals("").and(m => 1 === m.ei).sortBy("position"); let l = T.categories.where("parentId").equals("").and(m => 0 === m.ei).sortBy("position"); h = Promise.all([h, l]).then(m => 1 < m.length ? new Promise(n => n(m[0].concat(m[1]))) : new Promise(n => n(m[0]))) } const k = $("#template_category > div:first-child"); h.then(function (l) {
        return g(function* () {
            for (const m of l) {
                const n =
                    !!m.parentId; if (2 > c && m.ei !== c || n) continue; let q = k.clone(); f.append(q); q.find("div[id='template_category_subcat_line_container']").addClass("hidden-element"); q.find("img[id='template_category_icon_img']").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + m.iconName + ".svg"); q.find("div[id='template_category_name']").text(m.name); if (2 === d) q.find("i[id='template_category_show_subcats']").addClass("hidden-element"), q.on("click touch", function () {
                        let r =
                            $("#input_new_category_main_category"); r.val(m.name); r.data("id", m.id); r.removeClass("is_hint is-invalid"); r.trigger("focus"); e.modal("hide"); f.empty()
                    }); else {
                    let r = "subs_container_" + m.name.replace(/[^a-zA-Z0-9]/g, ""); q.on("click touch", function () { Gc.has(m.id) ? (Gc.delete(m.id), $("#" + r).remove()) : (Gc.add(m.id), 0 === d ? T.categories.where("parentId").equals(m.id).count(u => { 1 === u ? T.categories.get({ parentId: m.id }, v => { Kc(b, v) }) : Lc(q, m, r, k, d, b) }) : Lc(q, m, r, k, d, b)); q.find("i[id='template_category_show_subcats']").css({ transform: "rotate(180deg)" }) });
                    1 === d && Gc.has(m.id) && Lc(q, m, r, k, d, b)
                }
            }
        })
    }).then(() => { 0 === b && (f.append("<button id='add_category_button' class='btn_flat d-flex align-items-center w-50 mt-2'>" + p.new_category + "</button>"), $("#add_category_button").on("click touch", () => { e.modal("hide"); $("#modal_add_transaction").modal("hide"); G("lastPrefCategoryEI", Z); $("#sidebar").find("#navbutton_preferences").trigger("click"); Jb($("#navbutton_pref_cat")) })) }); Mc(e, k, b, c, d); a ? (e.find("#modal_item_list_title").text(p.select_category), a = e.find("#modal_list_ok"),
        1 === d ? (a.parent().removeClass("hidden-element"), a.off("click touch").on("click touch", () => { { const m = Array.from(Hc).join(", "); if (1 === b) { var l = $("#input_add_budget_category"); l.val(m); l.removeClass("is_hint is-invalid"); l.trigger("focus") } else 3 === b && (l = $("#input_tr_search_category"), l.val(m), l.removeClass("is_hint is-invalid"), l = $("#input_tr_search_category_lateral"), l.val(m), l.removeClass("is_hint is-invalid"), populateTransactionList(m)); $("#modal_item_list").modal("hide") } })) : a.parent().addClass("hidden-element"),
        e.modal("show")) : e.modal("handleUpdate")
}
function Mc(a, b, c, d, e) {
    const f = a.find("#searchbar_modal_list_container"); if (2 <= e) f.addClass("hidden-element"); else {
        f.removeClass("hidden-element"); 0 === e ? 0 === Z ? f.find(".search_icon").removeClass("green").addClass("red") : f.find(".search_icon").removeClass("red").addClass("green") : f.find(".search_icon").removeClass("green red"); var h = a.find("#searchbar_modal_list"); h.off("input"); h.val(""); h.on("input", () => {
            let k = h.val(); if (0 === k.length) Ic(!1, c, d, e); else {
                k = k.toLowerCase(); var l = a.find("#modal_item_list_container");
                l.empty(); (2 > d ? T.categories.where("ei").equals(d) : T.categories.limit(50)).sortBy("name", function (m) { let n = 0; for (const q of m) q.parentId && q.name.toLowerCase().startsWith(k) && (m = b.clone(), l.append(m), Nc(m, q, e, c, !0), n++); 0 === n && l.append('<div class="w-100 text-center py-0 my-4"> - </div>') })
            }
        })
    }
}
function Lc(a, b, c, d, e, f) { a.after("<div id='" + c + "'></div>"); let h = $("#" + c); T.categories.where("parentId").equals(b.id).sortBy("position", function (k) { let l = 1; const m = k.length; for (const n of k) k = d.clone(), h.append(k), Nc(k, n, e, f, l === m), l++ }) }
function Nc(a, b, c, d, e) {
    a.find("img[id='template_category_icon_img']").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + b.iconName + ".svg"); a.find("div[id='template_category_name']").text(b.name); a.find("i[id='template_category_show_subcats']").addClass("hidden-element"); e && a.find("div[id='template_category_subcat_bottom_line']").addClass("invisible-keep-space-element"); 1 === c && Hc.has(b.name) && a.addClass("is_selected"); a.on("click touch", function () {
        0 ===
            c ? Kc(d, b) : Hc.has(b.name) ? (Hc.delete(b.name), a.removeClass("is_selected")) : (Hc.add(b.name), a.addClass("is_selected"), Gc.add(b.parentId))
    })
}
function Kc(a, b) { 0 === a ? qc(b.name, b.iconName, !0) : 1 === a ? (a = $("#input_add_budget_category"), a.val(b.name), a.removeClass("is_hint is-invalid"), a.trigger("focus")) : 11 === a && (a = $("#input_new_template_category"), a.val(b.name), a.removeClass("is_hint is-invalid"), a.trigger("focus"), $("#new_template_category_icon").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" + b.iconName + ".svg")); $("#modal_item_list").modal("hide") }
function pc() {
    var a = Z; const b = ra(2, "modal_item_list"), c = b.find("#modal_item_list_container"); c.empty(); $("#modal_item_list_title").text(p.select_transaction_template); let d = $("#template_tr_temp").html(), e = 0; T.transactionTemplates.orderBy("position").each(f => {
        if (f.ei === a) {
            c.append(d); var h = $("div[id='template_template_container']").last(), k = Pa.get(f.category); h.find("img[id='template_tr_temp_icon_img']").on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src", "/static/icons/" +
                k + ".svg"); h.find("div[id='template_tr_temp_name']").text(f.name); h.on("click touch", function () { xc(f); b.modal("hide") }); e++
        }
    }).then(() => {
        1 > e && c.append('<div class="w-100 text-center py-0 my-4">' + p.no_transaction_template_found + "</div>"); c.append("<button id='add_template_button' class='btn_flat d-flex align-items-center w-50 mt-2'>" + (0 === Z ? p.new_expense_template : p.new_income_template) + "</button>"); $("#add_template_button").on("click touch", () => {
            b.modal("hide"); $("#modal_add_transaction").modal("hide");
            G("lastPrefTemplateEI", Z); $("#sidebar").find("#navbutton_preferences").trigger("click"); Jb($("#navbutton_pref_temp"))
        })
    }); $("#modal_list_ok").parent().addClass("hidden-element"); b.modal("show")
}
function Oc(a) {
    const b = ra(2, "modal_icon_list").find("#modal_icon_list_container"); b.empty(); $("#modal_icon_list_title").text(p.icons); jQuery.post(p.url_icon_list, c => {
        c = JSON.parse(c); S && (c = c.splice(0, 62)); c.forEach(d => {
            b.append('\n    <div id="template_icon" class="col p-0">\n      <img id="template_icon_img" draggable="false" class="transaction_icon m-2" src=""/>\n    </div>'); let e = $("img[id='template_icon_img']").last(); e.on("error", function () { $(this).attr("src", "/static/icons/ic_blank_grey.svg") }).attr("src",
                "/static/icons/" + d + ".svg"); e.on("click touch", function () { if (0 === a) { var f = $("#add_budget_icon"); f.attr("src", "/static/icons/" + d + ".svg"); f.data("icon-selected", d) } else f = $("#new_category_icon"), f.attr("src", "/static/icons/" + d + ".svg"), f.data("icon-selected", d); $("#modal_icon_list").modal("hide") })
        }); if (S) {
            switch (w) {
                case "en": c = "More icons are available in the full version"; break; case "it": c = "Altre icone sono disponibili nella versione completa"; break; case "es": c = "M\u00e1s \u00edconos est\u00e1n disponibles en la versi\u00f3n completa";
                    break; case "pt": c = "Mais \u00edcones est\u00e3o dispon\u00edveis na vers\u00e3o completa"; break; case "de": c = "Weitere Symbole sind in der Vollversion verf\u00fcgbar"; break; case "fr": c = "Plus ic\u00f4nes sont disponibles dans la version compl\u00e8te"; break; case "pl": c = "Wi\u0119cej ikon jest dost\u0119pnych w pe\u0142nej wersji"; break; case "el": c = "\u03a0\u03b5\u03c1\u03b9\u03c3\u03c3\u03cc\u03c4\u03b5\u03c1\u03b1 \u03b5\u03b9\u03ba\u03bf\u03bd\u03af\u03b4\u03b9\u03b1 \u03b5\u03af\u03bd\u03b1\u03b9 \u03b4\u03b9\u03b1\u03b8\u03ad\u03c3\u03b9\u03bc\u03b1 \u03c3\u03c4\u03b7\u03bd \u03c0\u03bb\u03ae\u03c1\u03b7 \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7";
                    break; default: c = "..."
            }b.append('<div id="text-center" class="w-100 mt-3 mb-2">' + c + "</div>")
        }
    }); $("#modal_icon_list").modal("show")
}; var Pc = 0, Qc = [], Rc = 0;
function Sc(a) {
    let b = parseInt(M("apiType", -1)), c = M("seCid", null); return 0 <= b && c ? Promise.resolve({ i: b, j: c }) : firebase.database().ref("bank/saltedge/ids/" + a).once("value").then(function (d) {
        if (!d.exists()) {
            var e = parseInt(oa("seApiTypeTemporary", -1)); if (0 <= e) return Promise.resolve({ i: e, j: null }); e = !1; switch (p.country_code_2l) {
                case "AD": case "AT": case "BE": case "BG": case "CH": case "HR": case "CZ": case "DK": case "EE": case "FI": case "FR": case "DE": case "GI": case "EL": case "HU": case "IS": case "IE": case "IM": case "IT": case "LV": case "LI": case "LT": case "LU": case "MT": case "MO": case "NL": case "NO": case "PL": case "PT": case "RO": case "SM": case "SK": case "SI": case "ES": case "SE": case "UK": case "VA": e = !0;
                    break; case "ZZ": return new Promise(f => { H(p.bank_sync, "Are you from Europe or UK?", p.yes + " (Europe)", !1, () => { G("seApiTypeTemporary", 1); f({ i: 1, j: null }) }); let h = $("#modal_message_close"); h.text(p.no); h.show(); h.on("click touch", function () { G("seApiTypeTemporary", 0); f({ i: 0, j: null }) }) })
            }return Promise.resolve({ i: e ? 1 : 0, j: null })
        } (e = d.child("cid").exists() ? d.child("cid").val() : null) && E("seCid", e); d = d.child("type").exists() ? parseInt(d.child("type").val()) : 1; E("apiType", d); return Promise.resolve({ i: d, j: e })
    })
}
function Tc(a, b, c) {
    c = void 0 === c ? !1 : c; return T.bsConnections.get(b).then(d => !c && d && 0 < d.lastRefreshTs && ("active" === d.state && d.lastCheckTs > Date.now() - 432E5 || d.lastCheckTs > Date.now() - 6E4) ? Promise.resolve(d) : firebase.database().ref("bank/saltedge/connections/" + a + "/" + b).once("value").then(function (e) {
        if (e.exists()) {
            var f = Promise; var h = f.resolve; {
                e = e.val(); let k; switch (parseInt(e.state)) { case 1: k = "active"; break; default: case 2: k = "inactive"; break; case 9: k = "destroyed" }e = {
                    id: b, providerId: e.p_id || null, providerCode: e.p_code ||
                        null, providerName: e.p_name || null, countryCode: e.cc || null, status: k, lastRefreshTs: e.refreshTs || -1, lastCheckTs: Date.now()
                }; T.bsConnections.put(e)
            } f = h.call(f, e)
        } else f = Promise.reject(); return f
    }))
}
function Uc(a) {
    return g(function* () {
        if (!a) return D(2, "bs_functions.js", "removeSaltEdgeConnection", "Empty connection id"), Promise.reject(); var b = firebase.auth().currentUser; const c = b.uid; b = yield b.getIdToken(); let d = (yield Sc(c)).j, e = { uid: c, token: b, se_cid: d, se_connection_id: a, caller: "Web app", version: "js v=" + p.js_version }; return new Promise(function (f, h) {
            jQuery.post({
                crossDomain: !0, contentType: "application/json", data: JSON.stringify(e), dataType: "json", url: p.url_bs_connection_revoke, success: k => g(function* () {
                    if (200 ===
                        k.status_code) return yield Vc(c, a), f(); p.is_debug && console.log("Connection delete error (success): " + (k ? k.toString() : "-")); D(2, "bs_functions.js", "Connection delete error (success)", k ? k.toString() : "-"); return h(p.Error + ": BS-DC1")
                }), error: (k, l, m) => g(function* () {
                    let n = yield Wc(k, l, m, c, a); if ("ConnectionNotFound" === n.errorClass || "ProviderNotFound" === n.errorClass) return yield Vc(c, a), f(); p.is_debug && console.log("Connection delete error: " + !!k.responseJSON ? JSON.stringify(k.responseJSON) : l + " - " + m); D(2,
                        "bs_functions.js", "Connection delete error: ", n.errorClass + ": " + n.errorDescription); return h(p.Error + ": BS-RC2")
                })
            })
        })
    })
}
function Xc(a, b, c, d) {
    c = void 0 === c ? null : c; d = void 0 === d ? !1 : d; return g(function* () {
        if (Qc && !d && Rc > Date.now() - 6E4) return Promise.resolve(Qc); let e = (yield Sc(a)).j; if (!e) return Qc = Date.now(), Promise.resolve([]); let f = { uid: a, token: b, se_cid: e, return_revoked: !0, caller: "Web app", version: "js v=" + p.js_version }; c && (f.se_connection_id = c); return new Promise(function (h, k) {
            jQuery.post({
                crossDomain: !0, contentType: "application/json", data: JSON.stringify(f), dataType: "json", url: p.url_bs_partner_consent_list, success: l => { if (l.list) return Qc = l.list, Rc = Date.now(), h(Qc); p.is_debug && console.log("Consent list error (success): " + !!l ? l.toString() : "-"); return k(null) }, error: (l, m, n) => g(function* () { let q = yield Wc(l, m, n, a, c), r = q ? q.errorClass + ": " + q.errorDescription : m + " - " + n; p.is_debug && console.log("Consent list error: " + r); D(2, "bs_functions.js", "Consent list error (error): ", r); return k(q.errorDescription) })
            })
        })
    })
}
function Yc(a, b) {
    b = void 0 === b ? null : b; return g(function* () {
        if (!a) return D(2, "bs_functions.js", "removeSaltEdgePartnerConsent", "Empty connection id"), Promise.reject(); var c = firebase.auth().currentUser; const d = c.uid; c = yield c.getIdToken(); let e = (yield Sc(d)).j; b || (b = yield Xc(d, c, a).then(h => { if (!h) return null; let k = null; h.forEach(l => { "active" === l.status && (k = l.id) }); return k })); if (!b) return Promise.reject(p.no_consents_found); let f = {
            uid: d, token: c, se_cid: e, se_connection_id: a, se_consent_id: b, caller: "Web app",
            version: "js v=" + p.js_version
        }; return new Promise(function (h, k) {
            jQuery.post({
                crossDomain: !0, contentType: "application/json", data: JSON.stringify(f), dataType: "json", url: p.url_bs_partner_consent_revoke, success: l => { if (200 === l.status_code) return h(); p.is_debug && console.log("Consent revoke error 1: " + (l ? l.toString() : "-")); D(2, "bs_functions.js", "Consent revoke error 1: ", l ? l.toString() : "-"); return k(p.Error + ": BS-RC1") }, error: (l, m, n) => g(function* () {
                    var q = yield Wc(l, m, n, d, a); if ("PartnerConsentNotFound" === q.errorClass) return h();
                    q = q ? q.errorClass + ": " + q.errorDescription : m + " - " + n; p.is_debug && console.log("Consent revoke error (error): " + q); D(2, "bs_functions.js", "Consent list error (error): ", q); return k(p.Error + ": BS-RC2")
                })
            })
        })
    })
}
function rb(a, b, c, d) {
    return g(function* () {
        let e = yield Sc(a), f = e.j; if (!f) return Pc = Date.now(), Promise.resolve(!1); let h = { uid: a, token: b, se_cid: f, tr_online_id: c, se_tr_id: d, caller: "Web app", version: "js v=" + p.js_version }, k = 0 === e.i ? p.url_bs_duplicated_tr : p.url_bs_partner_duplicated_tr; G("lastTransactionAction", Date.now()); return new Promise(function (l, m) {
            jQuery.post({
                crossDomain: !0, contentType: "application/json", data: JSON.stringify(h), dataType: "json", url: k, success: n => {
                    if (n.status_code && 200 === parseInt(n.status_code)) return l();
                    p.is_debug && console.log("Mark transaction as duplicated (success): " + (n ? n.toString() : "-")); return m(p.error)
                }, error: (n, q, r) => g(function* () { let u = yield Wc(n, q, r, a, null), v = u ? u.errorClass + ": " + u.errorDescription : q + " - " + r; p.is_debug && console.log("Mark transaction as duplicated: " + v); D(2, "bs_functions.js", "Mark transaction as duplicated: ", v); return m(u.errorDescription) })
            })
        })
    })
}
function Wc(a, b, c, d, e) {
    e = void 0 === e ? null : e; return g(function* () {
        $("#progress_waiting_container_external").addClass("hidden-element"); let f; f = a.responseJSON ? { error: a.responseJSON.error || p.error, errorDescription: a.responseJSON.error_description || p.error, errorClass: a.responseJSON.error_class || p.error, reconnectRequired: !!a.responseJSON.reconnect_required || !1 } : { error: b + " " + c, errorDescription: p.error, errorClass: "-", reconnectRequired: !1 }; "ConnectionNotFound" === f.errorClass || "ProviderNotFound" === f.errorClass ?
            e && (yield Vc(d, e)) : "CustomerNotFound" === f.errorClass ? (E("seCid", null), D(3, "bs_function.js", "Salt Edge - CustomerNotFound")) : "idsNotMatched" === f.errorClass ? (E("seCid", null), D(3, "bs_function.js", "Salt Edge - IdsNotMatched")) : "CustomerLocked" === f.errorClass && D(2, "bs_function.js", "Salt Edge - CustomerLocked"); return f
    })
}
function Vc(a, b) {
    T.bsConnections.delete(b); return T.accounts.where("bsConnectionId").equals(b).toArray(c => {
        if (!c) return Promise.resolve(); const d = firebase.database().ref("usersDatabase/" + a); let e = { bs_id: null, bs_conn_id: null, ts: firebase.database.ServerValue.TIMESTAMP }, f = []; c.forEach(h => {
            T.accounts.update(h.id, { bsId: null, bsConnectionId: null }); T.transactions.where("account").equals(h.name).toArray(k => { for (let l = 0; l < k.length; l++) { let m = k[l]; m.bsIsPending && T.transactions.update(m.id, { bsIsPending: !1 }) } });
            f.push(d.child("/accounts/" + h.id).update(e).catch(k => { $("#progress_waiting_container_external").addClass("hidden-element"); B(); D(3, "bs_functions.js", "Error unlinking bs account", k) }))
        }); return Promise.allSettled(f)
    })
}; function uc() { let a = p.is_debug ? window.location.protocol + "//" + window.location.hostname + (window.location.port ? ":" + window.location.port : "") : "https://" + window.location.hostname, b = new Dropbox.Dropbox({ clientId: p.is_debug ? "y52ist7fdb3uql2" : "2m3run1fgyajob6" }); window.location.href = b.auth.getAuthenticationUrl(a + "/") } function Gb() { let a = window.location.hash.substr(1).split("&").reduce(function (b, c) { c = c.split("="); b[c[0]] = c[1]; return b }, {}); a.access_token && E("dbx_at", a.access_token) }
function lb(a, b, c) {
    let d = M("dbx_at", null); if (!d) return uc(), Promise.reject(); a = "/Photo/" + a; return (new Dropbox.Dropbox({ accessToken: d })).filesGetTemporaryLink({ path: a }).then(function (e) { e.result.link ? (b.attr("src", e.result.link), b.removeClass("hidden-element"), b.off("click touch").on("click touch", f => { f.preventDefault(); f.stopPropagation(); f.cancelBubble = !0 }), c.addClass("hidden-element")) : (c.removeClass("hidden-element"), b.addClass("hidden-element")) }).catch(function (e) {
        e.status && 401 === parseInt(e.status) &&
            E("dbx_at", null); c.removeClass("hidden-element"); b.addClass("hidden-element"); D(2, "dropbox_interface.js", "Download photo from Dropbox", e)
    })
}
function zc(a, b) {
    return g(function* () {
        let c = M("dbx_at", null); if (!c) return uc(), Promise.reject(); let d = a.prop("files")[0]; if (!d) return a.addClass("is-invalid"), b.text(p.error), b.removeClass("hidden-element"), Promise.reject(); var e = d.name; let f = d.size, h = d.type; if ("image/png" !== h && "image/jpeg" !== h) return a.addClass("is-invalid"), b.text(p.error + ": .png/.jpeg " + p.required), b.removeClass("hidden-element"), Promise.reject(); 1E5 < f && (d = yield Zc(d)); e = "/Photo/" + e; return (new Dropbox.Dropbox({ accessToken: c })).filesUpload({
            path: e,
            contents: d, mode: "overwrite", mute: !0
        }).then(function (k) { a.removeClass("is-invalid"); if (k && 200 === k.status) return b.addClass("hidden-element"), Promise.resolve(!0); b.text(p.error + ": " + p.photo); b.removeClass("hidden-element"); B(null, p.photo + " - Error uploading the photo"); return Promise.reject() }).catch(function (k) { k.status && 401 === parseInt(k.status) && E("dbx_at", null); a.addClass("is-invalid"); b.removeClass("hidden-element"); D(2, "dropbox_interface.js", "Download photo from Dropbox", k); return Promise.reject() })
    })
}
function Zc(a) { return a ? new Promise((b, c) => { new Compressor(a, { quality: .8, maxWidth: 2048, maxHeight: 2048, convertSize: 0, ["success"](d) { return b(d) }, ["error"](d) { p.is_debug && console.log(d.message); return c() } }) }) : Promise.reject() }; var ConnectionType;
