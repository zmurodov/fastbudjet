/*
 Copyright ?2018-2021 AppFer S.R.L. - All rights reserved. */
'use strict'; function ea(a) { function b(d) { return a.next(d) } function c(d) { return a.throw(d) } return new Promise(function (d, e) { function f(h) { h.done ? d(h.value) : Promise.resolve(h.value).then(b, c).then(f, e) } f(a.next()) }) } function g(a) { return ea(a()) } var p, t = new Map, w = Cookies.get("locale"); null == w && (w = "en"); function x(a, b, c) { try { return (new Intl.NumberFormat(b, { style: "currency", currency: c })).format(a) } catch (d) { return fa(parseFloat(a), b, 2, 2) } }
function fa(a, b, c = 2, d = 2) { return (new Intl.NumberFormat(b, { style: "decimal", maximumFractionDigits: c, minimumFractionDigits: d })).format(a) } function y(a, b) { return (new Date(a)).toLocaleDateString(b ? b : "en", { year: "numeric", month: "2-digit", day: "2-digit" }) }
function A(a, b, c, d, e = !0) {
    if (!a) return B(), D(3, "common_functions.js", "loadTemplateFromBackend", "Empty html path" + (b ? " - Script path: " + b : "")), Promise.reject("500"); c || (c = $("#main_page_content")); c.empty(); $("#progress_waiting_container_internal").removeClass("hidden-element"); null == d && (d = { no_data: 0 }); return new Promise((f, h) => c.load(a, d, (k, l, m) => {
        $("#progress_waiting_container_internal").addClass("hidden-element"); if (401 === m.status) return firebase.auth().signOut(), ha(), E("lastSyncTs", null), E("lastSettingsSyncTs",
            null), E("transactionsSyncFromTs", null), indexedDB.deleteDatabase("fastBudgetDB"), k = JSON.parse(k), k.hasOwnProperty("error_message") && alert(k.error_message), ia(), h("401"); if ("error" === l) return console.log("Error: " + m.status + ": " + m.statusText), D(3, "common_functions.js", "loadTemplateFromBackend", "Cannot load page: " + a + ", Code: " + m.status + ", Text: " + m.statusText), B(), h(); e && history.pushState({ html_path: a, script_path: b, data: d }, "", a); return null != b ? ja(b, f, h) : f()
    }))
}
function ja(a, b = null, c = null) { "/" === a.charAt(0) || a.startsWith("https") || (a = "/" + a); return jQuery.ajax({ crossDomain: !0, dataType: "script", cache: !0, url: a, success: () => b ? b() : Promise.resolve(), error: () => { D(2, "common_functions.js", "loadScriptFromBackend", "Script: " + a); B(); return c ? c() : Promise.reject() } }) } function F(a) { a = $("#" + a); p ? jQuery.extend(p, JSON.parse(String(a.text()))) : p = JSON.parse(String($("#js_data_holder").text())); a.remove() }
function ka() {
    var a = $("#span_terms_of_services"), b = p; let c = a.html(); c.includes(b.terms_of_service) && c.includes(b.privacy_policy) ? (c = c.replace(new RegExp(b.terms_of_service, "ig"), '<a target="_blank" href="' + b.terms_of_service_url + '">' + b.terms_of_service + "</a>"), c = c.replace(new RegExp(b.privacy_policy, "ig"), '<a target="_blank" href="' + b.privacy_policy_url + '">' + b.privacy_policy + "</a>")) : c = c.concat('<br><a target="_blank" href="' + b.terms_of_service_url + '">' + b.terms_of_service + '</a> - <a target="_blank" href="' +
        b.privacy_policy_url + '">' + b.privacy_policy + "</a>"); a.html(c)
}
function la() {
    jQuery.ajax({
        url: p.url_user_log_out, method: "post", complete: function () {
            gtag("event", "logout", { event_category: "engagement" }); "function" === typeof ha && ha(); p.is_debug && E("apiType", null); E("seCid", null); E("user:previous_user_and_type", null); E("lastSyncTs", null); E("lastSettingsSyncTs", null); E("transactionsSyncFromTs", null); E("dbx_at", null); G("validationEmailSent", null); G("lastValidationEmailSentDate", null); indexedDB.deleteDatabase("fastBudgetDB"); firebase.auth().signOut().then(() => {
                G("lastRedirect",
                    Date.now().toString()); ia()
            })
        }
    })
} function na(a) { a || (a = firebase.auth().currentUser); if (a.emailVerified) return Promise.resolve(!0); if ("true" === oa("validationEmailSent", "false")) return G("validationEmailSent", null), a.reload().then(b => na(b)); H(p.validate_email, p.validate_email_to_proceed, p.validate_email, !1, () => { $("#modal_message").modal("hide"); pa(a) }); return Promise.resolve(!1) }
function pa(a) {
    if (parseInt(oa("lastValidationEmailSentDate", 0)) < Date.now() - 3E5) firebase.auth().useDeviceLanguage(), a.sendEmailVerification().then(function () { G("validationEmailSent", "true"); G("lastValidationEmailSentDate", Date.now()); let b = p.validation_email_sent_to.replace("%s", '"' + a.email + '"'); H(null, b, p.ok, !1, null); $("#modal_message").modal("show") }).catch(function () { B(p.error, "Too many requests, retry later"); $("#modal_message").modal("show") }); else {
        let b = p.validation_email_sent_to.replace("%s",
            '"' + a.email + '"'); H(null, b, p.ok, !1, null); $("#modal_message").modal("show")
    }
} function ia() { null == p && F("js_data_holder"); document.location.href = p.url_authentication_page } function qa(a) { return a.charAt(0).toUpperCase() + a.slice(1) } function E(a, b) { null != b ? window.localStorage.setItem(a, b) : window.localStorage.removeItem(a) } function M(a, b) { a = window.localStorage.getItem(a); null == a && (a = b); return a } function G(a, b) { null != b ? window.sessionStorage.setItem(a, b) : window.sessionStorage.removeItem(a) }
function oa(a, b) { a = window.sessionStorage.getItem(a); null == a && (a = b); return a } function D(a, b, c, d) { jQuery.ajax({ url: p.url_log, method: "post", data: { severity: a, file: b + (p ? " (v" + p.js_version + ")" : ""), action: c, mex: d } }); p.is_debug && console.log("Sev:" + a + " File: " + b + " Action: " + c + " Mex: " + d) }
function ra(a = 1, b = "modal_container") {
    const c = $("#" + b); 1 === a ? (c.css("z-index", 1400), c.off("show.bs.modal").on("shown.bs.modal", () => { $("body").css("overflow-y", "hidden") }), c.off("hidden.bs.modal").on("hidden.bs.modal", () => { $("body").css("overflow-y", "auto") })) : 2 === a ? (c.css("z-index", 1500), c.off("hide.bs.modal"), c.off("hidden.bs.modal")) : 3 === a && (c.css("z-index", 1600), c.off("hide.bs.modal"), c.off("hidden.bs.modal")); c.off("shown.bs.modal").on("shown.bs.modal", () => {
        const d = $("div.modal-backdrop").last();
        d.css("background", "#000000AA"); 1 === a ? d.css("z-index", c.css("z-index") - 1) : 2 === a ? d.css("z-index", c.css("z-index") - 1) : 3 === a && d.css("z-index", c.css("z-index") - 1)
    }); return c
}
function B(a, b) { $("#modal_message_title").text(a ? a : p.error); $("#modal_message_content").text(b ? b : p.to_solve_try_to_refresh_the_page); a = $("#modal_message_confirmation"); a.text(p.ok); a.off("click touch").on("click touch", () => { $("#modal_message").modal("hide") }); $("#modal_message_header").show(); $("#modal_message_close").hide(); $("#modal_message_checkbox_parent").hide(); $("#modal_message").modal("show") }
function sa(a, b, c, d) { $("#modal_message_title").text(a); $("#modal_message_content").text(b); $("#modal_message_header").show(); $("#modal_message_close").show(); $("#modal_message_checkbox_parent").hide(); let e = $("#modal_message_confirmation"); e.text(c ? c : () => { let f = e.data("deftxt"); return f ? f : "Ok" }); e.off("click touch").on("click touch", d); $("#modal_message").modal({ backdrop: "static", keyboard: !1, show: !0 }) }
function H(a, b, c, d, e) { a ? ($("#modal_message_title").text(a), $("#modal_message_header").show()) : $("#modal_message_header").hide(); $("#modal_message_content").text(b); $("#modal_message_close").hide(); d ? $("#modal_message_checkbox_parent").show() : $("#modal_message_checkbox_parent").hide(); let f = $("#modal_message_confirmation"); f.text(c ? c : () => { let h = f.data("deftxt"); return h ? h : "Ok" }); f.off("click touch").on("click touch", e); $("#modal_message").modal("show") }
function O(a, b, c = 0, d = 1E3, e = null) { if (0 < c) { if (!b || 0 === b.length) return a.addClass("is-invalid"), e && $("#" + e).text(p.error_field_required), !1; if (b.length < c) return a.addClass("is-invalid"), e && $("#" + e).text(p.error_short_value.replace("%1$s", c)), !1 } if (b.length > d) return a.addClass("is-invalid"), e && $("#" + e).text(p.error_long_value.replace("%1$d", d)), !1; a.removeClass("is-invalid"); return !0 };
